MPASM  5.50  /HOME/MOONSHINE/SPEEDBUS/PIC/MPL   3-24-2014  15:36:40         PAGE  1


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

Warning[205]: Found directive in column 1. (List)
                      00001 List      P=16f690              ; list directive to define processor
                      00002 
                      00003 #include "p16f690.inc"
                      00001         LIST
                      00002 
                      00003 ;==========================================================================
                      00004 ;  MPASM PIC16F690 processor include
                      00005 ; 
                      00006 ;  (c) Copyright 1999-2013 Microchip Technology, All rights reserved
                      00007 ;==========================================================================
                      00008 
                      00756         LIST
                      00004 
                      00005 ; CONFIG
                      00006 ; __CONFIG _CONFIG1, 0x30D5
2007   30D4           00007  __CONFIG _INTOSCIO & _WDTE_OFF & _PWRTE_OFF & _MCLRE_OFF & _CP_OFF & _CPD_OFF & _BOREN_OFF & _IESO_OFF 
                            & _FCMEN_OFF
                      00008 
                      00009 ; RA1 = Check for led strip 1
                      00010 ; RC2 = Check for led strip 2
                      00011 ; RB6 = Controller for fan
                      00012 
                      00013 ; RA5 = Temp in grow house
                      00014 ; RA4 = Temp for heat sink
                      00015 
                      00016 
                      00017 ; IMPORTATNT! All the speedlib pre definitions, MUST be definde before the include
                      00018 #define ARC_16F         1
                      00019 ;#define ARC_18F         1
                      00020 #define REC_CUSTOM_JUMP     custom_command_handler
                      00021 ;#define CUSTOM_INTERRUPT    c_intserv
                      00022 #define DEV_ID1 64
                      00023 #define DEV_ID2 50
                      00024 #define WRITE_EEPROM write_eeprom
                      00025 #define READ_EEPROM read_eeprom
                      00026 #include "../SpeedBus.PIC.Lib.X/speedlib_main.asm"
                      00001 ;#include "/usr/share/gputils/header/p16f690.inc"
                      00002 ;            errorlevel -302
                      00003 
                      00004 ;
                      00005 ;   #define     REC_CUSTOM_JUMP         custom_command_handler ; This is the name of the command to use,
                             if it is a custom command. like, "jump to this statment if it is a custom command"
                      00006 ;   #define     CUSTOM_INTERRUPT        c_intserv              ; NOTE: When use this define, remember th
                            at the jumpback, to the ordinary interupthandler, need to be "ci_restore", if the interupt does 
                      00007 ;
                      00008 ;
                      00009 ; Using two device id:s, maybe not predefined, so...
                      00010 ; The definition of thease bytes should not be done in the lib file, but in the main asm file, so difren
                            t deviceid:s on difrent sources can be used.
                      00011 
                      00012 ; REMEMBER: Well, byte 0-9 is reserved for speedbus in eeprom
                      00013 
MPASM  5.50  /HOME/MOONSHINE/SPEEDBUS/PIC/MPL   3-24-2014  15:36:40         PAGE  2


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00014 ; The I/O where the txen for the 485buss should be output
                      00015 #ifndef OUTREG
                      00016 #define OUTREG PORTB
                      00017 #endif
                      00018 #ifndef OUTNUM
                      00019 #define OUTNUM 4
                      00020 #endif
                      00021 
                      00022 
                      00023 #ifndef DEV_ID1
                      00024 #define DEV_ID1 0
                      00025 #endif
                      00026 #ifndef DEV_ID2
                      00027 #define DEV_ID2 0
                      00028 #endif
                      00029 
                      00030 #ifndef FSR
                      00031 #define FSR FSR1L
                      00032 #endif
                      00033 
                      00034 #ifndef INDF
                      00035 #define INDF INDF1
                      00036 #endif
                      00037 
                      00038 #ifndef EEDAT
                      00039 #define EEDAT EEDATA
                      00040 #endif
                      00041 
                      00042 #define SPEEDLIB_RESPONSE_DELAY 9
                      00043 
Warning[205]: Found directive in column 1. (radix)
                      00044 radix dec
                      00045 ; IMPORTANT, do NOT change any of the varables down here, to a new bank, because
                      00046 ; the banksel instructions are configured, as all the varables bellow are in the
                      00047 ; same bank. As they should be.
                      00048 #define     USER_VARIABLE_SPACE         0x67    ; 0x65 but added two, just in case
                      00049         cblock  0x20
  00000020            00050              d1                 ; Define three file registers for the
  00000021            00051          d2                     ; delay loop
  00000022            00052              d3
  00000023            00053              d4
  00000024            00054              tmp_W
  00000025            00055              tmp_STATUS
  00000026            00056              tmp_PCLATH
  00000027            00057              d1_tmp
  00000028            00058              d2_tmp
  00000029            00059              d3_tmp
  0000002A            00060              rand
  0000002B            00061              loop1          ; Loop mem 1
  0000002C            00062              loop2          ; Loop mem 2
  0000002D            00063              rc_listen              ; |X-------|b7 = NoNE
                      00064                                 ; |-X------|b6 = NoNE
                      00065                                 ; |--X-----|b5 = This bit is used as the old "rc_gotflag", sets to 1, if
MPASM  5.50  /HOME/MOONSHINE/SPEEDBUS/PIC/MPL   3-24-2014  15:36:40         PAGE  3


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                             it "got a flag".
                      00066                                 ; |---X----|b4 = This bit specifies, that when reciving an 0x01, destion
                            ated for ME, do not send a "is ocupied package". This is good if you want to "search for units"
                      00067                                 ; |----X---|b3 = This bit got set if the device recive a usual response 
                            package (0x00)
                      00068                                 ; |-----X--|b2 = This is an internal function for the recsave rutine, so
                             the cewd know that following byte is escaped.
                      00069                                 ; |------X-|b1 = If you set this bit to 1 the cewd will handle the byte 
                            as loopback, and if it dosent match the byte in rc_nocoll
                      00070                                 ; |-------X|b0 = If you set this bit to one, when the device recives a "
                            is ocupied" pack, itn will uncheck this bit.
                      00071                                 ;                If this bit is zero, the device will send a "i am ocupi
                            ed" pack.
  0000002E            00072              rc_counter         ; RC framelen
  0000002F            00073              rc_nocoll          ; Use this to confim that no collission has ocurred
  00000030            00074              rc_add_byte        ; recsave_add temporary argument
  00000031            00075          rsp_adress1    ; The response adress at the bus
  00000032            00076              rsp_adress2        ; The response adress at the bus
  00000033            00077              adress1            ; The adress at the bus
  00000034            00078              adress2            ; The adress at the bus
  00000035            00079              speedlib_config        ; |X-------|b7 = NoNE
                      00080                                 ; |-X------|b6 = NoNE
                      00081                                 ; |--X-----|b5 = NoNE
                      00082                                 ; |---X----|b4 = NoNE
                      00083                                 ; |----X---|b3 = NoNe
                      00084                                 ; |-----X--|b2 = NoNe
                      00085                                 ; |------X-|b1 = Set this bit 1 if adress is stamped.
                      00086                                 ; |-------X|b0 = On, Off this bit, if you want to make the device check 
                            the adress on startup.
  00000036            00087              speedlib_main          ; |X-------|b7 = NoNE
                      00088                                 ; |-X------|b6 = NoNE
                      00089                                 ; |--X-----|b5 = NoNE
                      00090                                 ; |---X----|b4 = NoNE
                      00091                                 ; |----X---|b3 = NoNe
                      00092                                 ; |-----X--|b2 = If this bit got set, the cewd will send a response pack
                            age when returning to restore
                      00093                                 ; |------X-|b1 = This bit should be set, if the device has sent an packa
                            ge, that should be responde to
                      00094                                 ; |-------X|b0 = This bit, is SET when an interupt has occured. If you s
                            et this to zero before youre rutine, and check the bit after, you will se if an interupt has ocu
  00000037            00095              crc0
  00000038            00096              crc1
  00000039            00097              crcloop
  0000003A            00098              crctmp
  0000003B            00099              framelen           ; TX framelen
  0000003C            00100              txtmp              ; temporary before sending
  0000003D            00101              txreturn           ; Hardcoded return, if nessesary(in interupts)
  0000003E            00102              txframe, tx1, tx2, tx3, tx4, tx5, tx6, tx7, tx8, tx9, tx10 ; Current package limit, 20B
  00000049            00103              tx11, tx12, tx13, tx14, tx15, tx16, tx17, tx18, tx19, tx20
  00000053            00104              rcframe, rc1, rc2, rc3, rc4, rc5, rc6, rc7, rc8, rc9, rc10 ; Current package limit, 20B
  0000005E            00105              rc11, rc12, rc13, rc14, rc15, rc16, rc17, rc18, rc19, rc20
                      00106         endc
                      00107         ;; EEPROM
MPASM  5.50  /HOME/MOONSHINE/SPEEDBUS/PIC/MPL   3-24-2014  15:36:40         PAGE  4


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00108         ;; 0x00 ; addr1
                      00109         ;; 0x01 ; addr2
                      00110         ;; 0x02 ; Speedbus configuration register
                      00111 
                      00112 .code_page0_ CODE
                      00113 
0000                  00114 init_speedlib:
                      00115 #ifndef FSR
                      00116     clrf    FSR1H
                      00117 #endif
                      00118 
                      00119 
                      00120     ;; Preset some values
0000   1283 1303      00121     banksel speedlib_main
0002   1136           00122     bcf     speedlib_main,2
0003   10B6           00123     bcf     speedlib_main,1
0004   1283 1303      00124     banksel OUTREG
0006   1206           00125     bcf     OUTREG,OUTNUM
0007   1283 1303      00126     banksel rc_listen
0009   10AD           00127     bcf     rc_listen,1
000A   122D           00128     bcf     rc_listen,4
000B   12AD           00129     bcf     rc_listen,5         ;; Clear got flag
000C   10BD           00130     bcf     txreturn, 1
                      00131 
                      00132 #ifdef  READ_EEPROM
                      00133     ;; Take adress from eeprom, if it is set.
000D   3000           00134     movlw   0
000E   2???           00135     call    READ_EEPROM
000F   1283 1303      00136     banksel adress1
0011   00B3           00137     movwf   adress1
0012   3001           00138     movlw   1
0013   2???           00139     call    READ_EEPROM
0014   1283 1303      00140     banksel adress2
0016   00B4           00141     movwf   adress2
0017   3002           00142     movlw   2
0018   2???           00143     call    READ_EEPROM
0019   1283 1303      00144     banksel speedlib_config
001B   00B5           00145     movwf   speedlib_config
                      00146 #endif
                      00147 
                      00148     ;; If adress is 255.255, change to 0.0
001C   30FF           00149     movlw       0xFF
001D   1283 1303      00150     banksel     adress1
001F   0233           00151     subwf       adress1,W
0020   1D03           00152     btfss       STATUS,Z
0021   0008           00153     return
0022   30FF           00154     movlw       0xFF
0023   1283 1303      00155     banksel     adress2
0025   0234           00156     subwf       adress2,W
0026   1D03           00157     btfss       STATUS,Z
0027   0008           00158     return
                      00159 
0028   1283 1303      00160     banksel     adress1
MPASM  5.50  /HOME/MOONSHINE/SPEEDBUS/PIC/MPL   3-24-2014  15:36:40         PAGE  5


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

002A   01B3           00161     clrf        adress1
002B   01B4           00162     clrf        adress2
                      00163 
                      00164 #ifdef  WRITE_EEPROM
002C   3000           00165     movlw   0
002D   00AF           00166     movwf   rc_nocoll
002E   0833           00167     movf    adress1,W
002F   2???           00168     call    WRITE_EEPROM
0030   1283 1303      00169     banksel rc_nocoll
0032   3001           00170     movlw   1
0033   00AF           00171     movwf   rc_nocoll
0034   0834           00172     movf    adress2,W
0035   2???           00173     call    WRITE_EEPROM
                      00174 #endif
                      00175 
                      00176     ;; Because the dreprecated version of the fucked up "checkaddr" function,
                      00177     ;; i removed the code. In wait for the new system.
                      00178     ;;
                      00179     ;; Handle response, needs testing.
                      00180 
0036   0008           00181     return
                      00182 
                      00183 
0037                  00184 intserv:
                      00185 
0037   1283 1303      00186     banksel speedlib_main
0039   1436           00187     bsf     speedlib_main,0     ;; Set this bit to one, when an interupt ocurres
                      00188 
                      00189 
003A   1CB6           00190     btfss       speedlib_main,1     ;; Waiting for response STATE? Jump direct to recend_no_broadcast
003B   2???           00191     goto    intserv_norm
003C   1283 1303      00192     banksel PIR1
003E   1A8C           00193     btfsc       PIR1,RCIF           ;; Check if the recived data bit is set
003F   2???           00194         goto    rec                 ;; Jump to recive data rutine if the PIR1 bit is 1
0040   2???           00195     goto    restore
                      00196 
0041                  00197 intserv_norm:
0041   1283 1303      00198     banksel tmp_W
0043   00A4           00199         movwf   tmp_W               ;; Register BKP before the interup code exec
0044   0803           00200         movf    STATUS,W
0045   0183           00201         clrf    STATUS
0046   00A5           00202         movwf   tmp_STATUS
0047   080A           00203         movf    PCLATH,W
0048   00A6           00204         movwf   tmp_PCLATH
0049   0820           00205         movf    d1,W
004A   00A7           00206         movwf   d1_tmp
004B   0821           00207         movf    d2,W
004C   00A8           00208         movwf   d2_tmp
004D   0822           00209         movf    d3,W
004E   00A9           00210         movwf   d3_tmp
                      00211 #ifdef  CUSTOM_INTERRUPT
                      00212     goto    CUSTOM_INTERRUPT
                      00213 ci_restore:
MPASM  5.50  /HOME/MOONSHINE/SPEEDBUS/PIC/MPL   3-24-2014  15:36:40         PAGE  6


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00214 #endif
                      00215 
004F   1283 1303      00216     banksel PIR1
0051   1A8C           00217         btfsc   PIR1,RCIF           ;; Check if the recived data bit is set
0052   2???           00218         goto    rec                 ;; Jump to recive data rutine if the PIR1 bit is 1
                      00219 
                      00220 
0053                  00221 restore:
0053   1283 1303      00222         banksel speedlib_main       ;; Restore the regisers
0055   18B6           00223     btfsc       speedlib_main,1     ;; Waiting for response STATE? Dont
0056   0009           00224     retfie                      ;; restore saved, nothing is saved
                      00225 
                      00226                                 ;;; If:  Send back a response package, to confirm that the package has b
                            een recived
                      00227 ;;  btfss   speedlib_main,2
                      00228 ;;  goto    restore_norm
                      00229 ;;  bcf     speedlib_main,2
                      00230 ;;  call    func_send_response
                      00231                                 ;;;
                      00232 
0057                  00233 restore_norm:
0057   0827           00234         movf    d1_tmp,W
0058   00A0           00235         movwf   d1
0059   0828           00236         movf    d2_tmp,W
005A   00A1           00237         movwf   d2
005B   0829           00238         movf    d3_tmp,W
005C   00A2           00239         movwf   d3      
005D   0826           00240         movf    tmp_PCLATH,W
005E   008A           00241         movwf   PCLATH
005F   0825           00242         movf    tmp_STATUS,W
0060   0083           00243         movwf   STATUS
0061   0EA4           00244         swapf   tmp_W,F
0062   0E24           00245         swapf   tmp_W,W
0063   0009           00246         retfie  
                      00247 
0064                  00248 rec:
0064   1283 1303      00249     banksel rc_listen
0066   1CAD           00250         btfss   rc_listen,1         ;; If rc_listen is set to NOT drop the loopback package, jump direct
                            ly to the rec_start
0067   2???           00251         goto    rec_start               
                      00252 
0068   10AD           00253         bcf     rc_listen,1         ;; Start this rutine with checking that the recived bit NOT was send
                             from this own device
0069   082F           00254         movf    rc_nocoll,W
006A   1283 1303      00255     banksel RCREG
006C   021A           00256         subwf   RCREG,W
006D   1D03           00257         btfss   STATUS,Z
006E   2???           00258         goto    rec_oops_coll           ;; Anyway, if the rc_listen,1  is 1, and it do not match RCREG, 
                            we may be detected an collission
006F   2???           00259         goto    restore
                      00260 
0070                  00261 rec_oops_coll:
0070   1283 1303      00262     banksel txreturn
MPASM  5.50  /HOME/MOONSHINE/SPEEDBUS/PIC/MPL   3-24-2014  15:36:40         PAGE  7


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0072   14BD           00263         bsf     txreturn,1
0073   2???           00264         goto    restore
                      00265         
0074                  00266 rec_start:
0074   1283 1303      00267     banksel RCREG
0076   307E           00268         movlw   0x7e
0077   021A           00269         subwf   RCREG,W
0078   1903           00270         btfsc   STATUS,Z
0079   2???           00271         goto    recx                ;; Jump if this is a flag bit
007A   1283 1303      00272     banksel rc_listen
007C   1AAD           00273         btfsc   rc_listen,5
007D   2???           00274         goto    recsave             ;; Jump if the flag bit is set
007E   2???           00275         goto    restore
                      00276 
007F                  00277 recx:
007F   1283 1303      00278     banksel rc_listen
0081   1AAD           00279         btfsc   rc_listen,5
0082   2???           00280         goto    recend              ;; If this may be end flag, check the package, finalize, check crc
0083   16AD           00281         bsf     rc_listen,5         ;; Else set the gotflag, and start recording package!
0084   01AE           00282         clrf    rc_counter          ;; Clear the counter :)
0085   2???           00283         goto    restore
                      00284 
0086                  00285 recsave:
0086   1283 1303      00286     banksel RCREG
0088   307D           00287         movlw   0x7d
0089   021A           00288         subwf   RCREG,W
008A   1903           00289         btfsc   STATUS,Z
008B   2???           00290         goto    recsave_set         ;; Set bit in the rc_listen to aktivate escape routines when the nex
                            t byte is recived
008C   1283 1303      00291         banksel rc_listen
008E   192D           00292     btfsc   rc_listen,2
008F   2???           00293         goto    recsave_unescape
                      00294 
0090   1283 1303      00295     banksel RCREG
0092   081A           00296         movf    RCREG,W
0093   2???           00297         goto    recsave_add
                      00298 
0094                  00299 recsave_set:
0094   1283 1303      00300     banksel rc_listen
0096   152D           00301         bsf     rc_listen,2
0097   2???           00302         goto    restore
                      00303 
0098                  00304 recsave_unescape:
0098   1283 1303      00305     banksel rc_listen
009A   112D           00306         bcf     rc_listen,2
009B   305E           00307         movlw   0x5e
009C   1283 1303      00308     banksel RCREG
009E   021A           00309         subwf   RCREG,W
009F   1903           00310         btfsc   STATUS,Z
00A0   2???           00311         goto    recsave_unescape_1
00A1   305D           00312         movlw   0x5d
00A2   021A           00313         subwf   RCREG,W
00A3   1903           00314         btfsc   STATUS,Z
MPASM  5.50  /HOME/MOONSHINE/SPEEDBUS/PIC/MPL   3-24-2014  15:36:40         PAGE  8


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

00A4   2???           00315         goto    recsave_unescape_2
00A5   2???           00316         goto    restore             ;; Maybe you can change this, but a fail package that is the result,
                             will also be CRC checked
                      00317         
00A6                  00318 recsave_unescape_1:
00A6   307E           00319         movlw   0x7e
00A7   2???           00320         goto    recsave_add
00A8                  00321 recsave_unescape_2:
00A8   307D           00322     movlw   0x7d
00A9   2???           00323         goto    recsave_add
                      00324         
00AA                  00325 recsave_add:
00AA   1283 1303      00326     banksel rc_add_byte
00AC   00B0           00327         movwf   rc_add_byte
00AD   3053           00328         movlw   rcframe             ;; Place where to put the receiving byte
00AE   072E           00329         addwf   rc_counter,W        ;; Add the number in rc_flow, to the pointer, like rcframe[rc_flow]
00AF   1283 1303      00330         banksel FSR
00B1   0084           00331     movwf       FSR
00B2   1283 1303      00332     banksel rc_add_byte
00B4   0830           00333         movf    rc_add_byte,W
00B5   1283 1303      00334     banksel INDF
00B7   0080           00335         movwf   INDF
00B8   1283 1303      00336     banksel rc_counter
00BA   0AAE           00337         incf    rc_counter,F
00BB   2???           00338         goto    restore
                      00339         
00BC                  00340 recend:
00BC   3005           00341     movlw   5
00BD   022E           00342     subwf   rc_counter,W
00BE   1C03           00343     btfss   STATUS,C
00BF   2???           00344     goto    reccrcfail
00C0   1283 1303      00345     banksel rc_counter
00C2   032E           00346         decf    rc_counter,W
00C3   00AE           00347         movwf   rc_counter
00C4   00B9           00348         movwf   crcloop
00C5   3053           00349         movlw   rcframe
00C6   1283 1303      00350     banksel FSR
00C8   0084           00351         movwf   FSR
00C9   1283 1303      00352     banksel crc0
00CB   01B7           00353         clrf    crc0
00CC   01B8           00354         clrf    crc1
00CD   2???           00355         call    crcloopr        ; Call CRC function
                      00356 
00CE   1283 1303      00357     banksel rcframe
00D0   3053           00358         movlw   rcframe
00D1   072E           00359         addwf   rc_counter,W
00D2   1283 1303      00360     banksel FSR
00D4   0084           00361         movwf   FSR
                      00362 
00D5   1283 1303      00363     banksel INDF
00D7   0800           00364         movf    INDF,W
                      00365 
00D8   1283 1303      00366     banksel crc1
MPASM  5.50  /HOME/MOONSHINE/SPEEDBUS/PIC/MPL   3-24-2014  15:36:40         PAGE  9


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

00DA   0238           00367         subwf   crc1,W
00DB   1D03           00368         btfss   STATUS,Z
00DC   2???           00369         goto    reccrcfail
00DD   1283 1303      00370     banksel FSR
00DF   0304           00371         decf    FSR,W
00E0   0084           00372         movwf   FSR
                      00373 
00E1   1283 1303      00374     banksel INDF
00E3   0800           00375         movf    INDF,W
                      00376 
00E4   1283 1303      00377     banksel crc0
00E6   0237           00378         subwf   crc0,W
00E7   1D03           00379         btfss   STATUS,Z
00E8   2???           00380         goto    reccrcfail
                      00381 
00E9   1283 1303      00382         banksel rc_listen           ;; REMEMBER, if checksum is right, clear "got flag", else, untuched
00EB   12AD           00383     bcf     rc_listen,5
                      00384 
00EC   3059           00385         movlw   rcframe+6           ;; Move recived byte to W
00ED   1283 1303      00386         banksel FSR
00EF   0084           00387     movwf       FSR
                      00388 
00F0                  00389 recend_tmp:
00F0   1283 1303      00390     banksel speedlib_main
00F2   18B6           00391     btfsc   speedlib_main,1     ;; No CUSTOM command when in Whait for RESP STATE
00F3   2???           00392     goto    recend_no_broadcast
00F4   2???           00393         goto    func_bc
                      00394 
00F5                  00395 recend_no_broadcast:
00F5   1283 1303      00396     banksel rcframe
00F7   3053           00397         movlw   rcframe
00F8   1283 1303      00398     banksel FSR
00FA   0084           00399         movwf   FSR
00FB   1283 1303      00400     banksel INDF
00FD   0800           00401         movf    INDF,W              ;; Check so that the adress is destinated for me
00FE   1283 1303      00402         banksel adress1
0100   0233           00403     subwf       adress1,W
0101   1D03           00404         btfss   STATUS,Z
0102   2???           00405         goto    restore
0103   1283 1303      00406     banksel FSR
0105   0A04           00407         incf    FSR,W
0106   0084           00408         movwf   FSR
0107   1283 1303      00409     banksel INDF
0109   0800           00410         movf    INDF,W
010A   1283 1303      00411     banksel adress2
010C   0234           00412         subwf   adress2,W
010D   1D03           00413         btfss   STATUS,Z
010E   2???           00414         goto    restore
                      00415 
010F   3059           00416         movlw   rcframe+6           ;; Move recived byte to W
0110   1283 1303      00417     banksel FSR
0112   0084           00418     movwf       FSR
                      00419 
MPASM  5.50  /HOME/MOONSHINE/SPEEDBUS/PIC/MPL   3-24-2014  15:36:40         PAGE 10


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0113   3000           00420         movlw   0x00                ;; Got response
0114   1283 1303      00421         banksel INDF
0116   0200           00422     subwf       INDF,W
0117   1903           00423         btfsc   STATUS,Z
0118   2???           00424         goto    func_check_response
                      00425 
0119   1283 1303      00426     banksel speedlib_main
011B   18B6           00427     btfsc   speedlib_main,1     ;; No CUSTOM command when in Whait for RESP STATE
011C   2???           00428     goto    restore
                      00429 
011D   0858           00430         movf    rcframe+5,W
011E   3C01           00431         sublw   0x01
011F   1903           00432         btfsc   STATUS,Z
0120   2???           00433     call    func_send_response
                      00434 
                      00435 
                      00436         
0121   3059           00437         movlw   rcframe+6           ;; Make sure that the FSR pointer is pointed right
0122   1283 1303      00438         banksel FSR
0124   0084           00439     movwf       FSR
                      00440 
0125   3001           00441         movlw   0x01                ;; Send respons for, 0x01 message, destionated for me
0126   1283 1303      00442         banksel INDF
0128   0200           00443     subwf       INDF,W
0129   1903           00444         btfsc   STATUS,Z
012A   2???           00445         goto    func_is_ocupied_send_response
                      00446         
012B   3002           00447         movlw   0x02
012C   0200           00448         subwf   INDF,W
012D   1903           00449         btfsc   STATUS,Z
012E   2???           00450         goto    func_setport
                      00451 
012F   3003           00452         movlw   0x03
0130   0200           00453         subwf   INDF,W
0131   1903           00454         btfsc   STATUS,Z
0132   2???           00455         goto    func_speedlib_config
                      00456 
                      00457 #ifdef  REC_CUSTOM_JUMP
0133   2???           00458     goto    REC_CUSTOM_JUMP
                      00459 #endif
0134   2???           00460         goto    restore
                      00461 
0135                  00462 func_speedlib_config:
0135   3009           00463         movlw   9
0136   1283 1303      00464     banksel rc_counter
0138   022E           00465         subwf   rc_counter,W
0139   1903           00466         btfsc   STATUS,Z
013A   2???           00467         goto    func_speedlib_config_basics
                      00468 
013B   1803           00469     btfsc   STATUS,C
013C   2???           00470     goto    func_speedlib_config_extended
013D   2???           00471     goto    restore
                      00472 
MPASM  5.50  /HOME/MOONSHINE/SPEEDBUS/PIC/MPL   3-24-2014  15:36:40         PAGE 11


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

013E                  00473 func_speedlib_config_extended:
013E   305A           00474     movlw       rcframe+7           ;; Make sure that the FSR pointer is pointed right
013F   1283 1303      00475         banksel FSR
0141   0084           00476     movwf       FSR
0142   3000           00477     movlw       0x00
0143   1283 1303      00478     banksel INDF
0145   0200           00479         subwf   INDF,W
0146   1903           00480         btfsc   STATUS,Z
0147   2???           00481         goto    func_speedlib_config_basics
0148   3001           00482         movlw   0x01
0149   0200           00483         subwf   INDF,W
014A   1903           00484         btfsc   STATUS,Z
014B   2???           00485         goto    func_speedlib_config_caddr
014C   2???           00486     goto    restore
                      00487 
                      00488 
014D                  00489 func_speedlib_config_caddr:
014D   300C           00490     movlw       12
014E   1283 1303      00491     banksel rc_counter
0150   022E           00492         subwf   rc_counter,W
0151   1C03           00493         btfss   STATUS,C            ;; If rc_counter NOT is more och equal to twelve, jump back
0152   2???           00494     goto    restore
                      00495 
0153   2???           00496     call    func_send_response
                      00497         
0154   305B           00498     movlw       rcframe+8           ;; Move recived byte to W
0155   1283 1303      00499     banksel FSR
0157   0084           00500         movwf   FSR
0158   30FF           00501     movlw   0xFF
0159   1283 1303      00502     banksel INDF
015B   0200           00503     subwf   INDF,W
015C   1D03           00504     btfss   STATUS,Z
015D   2???           00505     goto    func_speedlib_config_caddr_f
015E   1283 1303      00506     banksel FSR
0160   0A84           00507     incf    FSR,F
0161   30FF           00508     movlw   0xFF
0162   1283 1303      00509     banksel INDF
0164   0200           00510     subwf   INDF,W
0165   1D03           00511     btfss   STATUS,Z
0166   2???           00512     goto    func_speedlib_config_caddr_f
0167   2???           00513     goto    restore
                      00514 
0168                  00515 func_speedlib_config_caddr_f:
0168   305B           00516     movlw       rcframe+8       ; Move recived byte to W
0169   1283 1303      00517     banksel FSR
016B   0084           00518         movwf   FSR
016C   1283 1303      00519     banksel INDF
016E   0800           00520     movf    INDF,W
016F   1283 1303      00521     banksel adress1
0171   00B3           00522     movwf   adress1
0172   1283 1303      00523     banksel FSR
0174   0A84           00524     incf    FSR,f
0175   1283 1303      00525     banksel INDF
MPASM  5.50  /HOME/MOONSHINE/SPEEDBUS/PIC/MPL   3-24-2014  15:36:40         PAGE 12


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0177   0800           00526     movf    INDF,W
0178   1283 1303      00527     banksel adress2
017A   00B4           00528     movwf   adress2
                      00529 
017B   14B5           00530     bsf     speedlib_config,1
                      00531 #ifdef  WRITE_EEPROM
                      00532     ;; Write adress to eeprom
017C   3000           00533     movlw   0
017D   00AF           00534     movwf   rc_nocoll
017E   0833           00535     movf    adress1,W
017F   2???           00536     call    WRITE_EEPROM
0180   1283 1303      00537     banksel rc_nocoll
0182   3001           00538     movlw   1
0183   00AF           00539     movwf   rc_nocoll
0184   0834           00540     movf    adress2,W
0185   2???           00541     call    WRITE_EEPROM
0186   1283 1303      00542     banksel rc_nocoll
0188   3002           00543     movlw   2
0189   00AF           00544     movwf   rc_nocoll
018A   0835           00545     movf    speedlib_config,W
018B   2???           00546     call    WRITE_EEPROM
                      00547 #endif
018C   2???           00548     goto    restore
                      00549 
018D                  00550 func_speedlib_config_basics:
018D   300C           00551     movlw   12
018E   2???           00552     call    Delay
018F   300B           00553         movlw   11
0190   1283 1303      00554     banksel framelen
0192   00BB           00555         movwf   framelen
                      00556 
0193   3055           00557     movlw       rcframe+2
0194   1283 1303      00558         banksel FSR
0196   0084           00559     movwf       FSR
0197   1283 1303      00560     banksel INDF
0199   0800           00561     movf    INDF,W
019A   1283 1303      00562     banksel txframe
019C   00BE           00563         movwf   txframe
                      00564 
019D   3056           00565     movlw       rcframe+3
019E   1283 1303      00566         banksel FSR
01A0   0084           00567     movwf       FSR
01A1   1283 1303      00568     banksel INDF
01A3   0800           00569     movf    INDF,W
01A4   1283 1303      00570     banksel txframe
01A6   00BF           00571         movwf   txframe+1
                      00572 
                      00573     ;; * my own src adress
01A7   0833           00574         movf    adress1, W
01A8   00C0           00575         movwf   txframe+2
                      00576 
                      00577     ;; * my own src adress
01A9   0834           00578         movf    adress2, W
MPASM  5.50  /HOME/MOONSHINE/SPEEDBUS/PIC/MPL   3-24-2014  15:36:40         PAGE 13


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

01AA   00C1           00579         movwf   txframe+3
                      00580 
                      00581     ;; 0x03 control bit
01AB   3003           00582         movlw   0x03
01AC   00C2           00583         movwf   txframe+4
                      00584 
                      00585     ;; 0x01     protocoll
01AD   3000           00586     movlw   0x00
01AE   00C3           00587         movwf   txframe+5
                      00588 
                      00589     ;; Data
01AF   3003           00590     movlw       0x03
01B0   00C4           00591         movwf   txframe+6
                      00592 
                      00593     ;; 0x00 Basic config response
01B1   3000           00594         movlw   0x00
01B2   00C5           00595     movwf   txframe+7
                      00596 
                      00597     ;; Send back speedlib_config
01B3   3035           00598         movlw   speedlib_config
01B4   00C6           00599     movwf   txframe+8
                      00600 
                      00601     ;; Padding bit
01B5   3000           00602         movlw   0x00
01B6   00C7           00603     movwf   txframe+9
                      00604 
01B7   2???           00605     call    txdo
01B8   2???           00606     goto    restore
                      00607 
01B9                  00608 func_send_response:
01B9   3009           00609     movlw   SPEEDLIB_RESPONSE_DELAY
01BA   2???           00610     call    Delay
01BB   1283 1303      00611     banksel framelen
01BD   3009           00612         movlw   9
01BE   00BB           00613         movwf   framelen
                      00614 
01BF   3055           00615     movlw       rcframe+2
01C0   1283 1303      00616     banksel FSR
01C2   0084           00617     movwf       FSR
01C3   1283 1303      00618     banksel INDF
01C5   0800           00619     movf    INDF,W
01C6   1283 1303      00620     banksel txframe
01C8   00BE           00621         movwf   txframe
                      00622 
01C9   3056           00623     movlw       rcframe+3
01CA   1283 1303      00624         banksel FSR
01CC   0084           00625     movwf       FSR
01CD   1283 1303      00626     banksel INDF
01CF   0800           00627     movf    INDF,W
01D0   1283 1303      00628     banksel txframe
01D2   00BF           00629         movwf   txframe+1
                      00630 
                      00631         ;; * my own src adress
MPASM  5.50  /HOME/MOONSHINE/SPEEDBUS/PIC/MPL   3-24-2014  15:36:40         PAGE 14


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

01D3   0833           00632         movf    adress1, W
01D4   00C0           00633         movwf   txframe+2
                      00634 
                      00635         ;; * my own src adress
01D5   0834           00636         movf    adress2, W
01D6   00C1           00637         movwf   txframe+3
                      00638 
                      00639         ;; 0x03 control bit
01D7   3003           00640         movlw   0x03
01D8   00C2           00641         movwf   txframe+4
                      00642 
                      00643         ;; 0x01 protocoll
01D9   3000           00644     movlw   0x00                ;; No response on response
01DA   00C3           00645         movwf   txframe+5   
                      00646 
                      00647         ;; Data             
01DB   3000           00648     movlw       0x00
01DC   00C4           00649         movwf   txframe+6
                      00650 
                      00651         ;; Padding bit
01DD   3000           00652         movlw   0x00
01DE   00C5           00653     movwf   txframe+7
                      00654 
01DF   2???           00655         call    txdo
01E0   0008           00656     return
                      00657 
01E1                  00658 func_check_response:
                      00659 ; May be more advanced in the future, but for now, i dont se any reason why
                      00660 ; we should make this functione more advanced, how many response packages are
                      00661 ; realy exchange in a cuple of ms? -.- //  Speedster
01E1   1283 1303      00662     banksel rc_listen
01E3   15AD           00663     bsf     rc_listen,3
01E4   2???           00664     goto        restore
                      00665 
                      00666 
01E5                  00667 func_is_ocupied_send_response:
01E5   300C           00668         movlw   12                  ;; Pretty strange, but you need this, so no colission or somthing wi
                            ll be made betwen PC and ansoring device
01E6   2???           00669         call    Delay
                      00670 
01E7   1283 1303      00671     banksel rc_listen
                      00672         ;; Send Package:
01E9   182D           00673     btfsc   rc_listen,0
01EA   2???           00674     goto    func_is_ocupied_send_response_got_resp
01EB   2???           00675     goto    func_is_ocupied_send_response_pack
Warning[208]: Label truncated at 32 characters. (func_is_ocupied_send_response_got_resp)
01EC                  00676 func_is_ocupied_send_response_got_resp:
01EC   102D           00677     bcf     rc_listen,0
01ED   2???           00678     goto    restore
                      00679 
Warning[208]: Label truncated at 32 characters. (func_is_ocupied_send_response_pack)
01EE                  00680 func_is_ocupied_send_response_pack:
01EE   1A2D           00681     btfsc   rc_listen,4
MPASM  5.50  /HOME/MOONSHINE/SPEEDBUS/PIC/MPL   3-24-2014  15:36:40         PAGE 15


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

01EF   2???           00682     goto    restore
01F0   3009           00683         movlw   9
01F1   1283 1303      00684     banksel framelen
01F3   00BB           00685         movwf   framelen
                      00686 
01F4   3055           00687         movlw   rcframe+2
01F5   1283 1303      00688         banksel FSR
01F7   0084           00689     movwf       FSR
01F8   1283 1303      00690     banksel INDF
01FA   0800           00691     movf    INDF,W
01FB   1283 1303      00692     banksel txframe
01FD   00BE           00693         movwf   txframe
                      00694 
01FE   3056           00695         movlw   rcframe+3
01FF   1283 1303      00696     banksel FSR
0201   0084           00697         movwf   FSR
0202   1283 1303      00698     banksel INDF
0204   0800           00699     movf    INDF,W
0205   1283 1303      00700     banksel txframe
0207   00BF           00701         movwf   txframe+1
                      00702 
                      00703         ;; * my own src adress
0208   0833           00704         movf    adress1, W
0209   00C0           00705         movwf   txframe+2
                      00706 
                      00707         ;; * my own src adress
020A   0834           00708         movf    adress2, W
020B   00C1           00709         movwf   txframe+3
                      00710 
                      00711         ;; 0x03 control bit
020C   3003           00712         movlw   0x03
020D   00C2           00713         movwf   txframe+4
                      00714 
                      00715         ;; 0x01 protocoll
020E   3000           00716     movlw   0x00
020F   00C3           00717         movwf   txframe+5
                      00718 
                      00719         ;; Data
0210   3001           00720     movlw       0x01
0211   00C4           00721         movwf   txframe+6
                      00722 
                      00723         ;; Padding bit
0212   3000           00724         movlw   0x00
0213   00C5           00725     movwf   txframe+7
                      00726 
0214   2???           00727         call    txdo    
                      00728 
0215   2???           00729         goto    restore
                      00730 
                      00731         
0216                  00732 func_bc:
                      00733 ; 120623 A new era has become speedbus, all package that are need to, shall for
                      00734 ; now be sent with an respons, and, for that reason, i no more use command 0x00
MPASM  5.50  /HOME/MOONSHINE/SPEEDBUS/PIC/MPL   3-24-2014  15:36:40         PAGE 16


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00735 ; for is_occupied commands. When an 0x01 NOT is broadcast(it got a real adress)
                      00736 ; It is ment to bee like an old 0x00, if it is not an bc, send is_occupied.
                      00737 ; For now on, 0x00 is used to respond packages that need a response! Over'n out
                      00738 ; // Speedster
                      00739 
0216   1283 1303      00740     banksel rcframe
0218   3053           00741         movlw   rcframe
0219   1283 1303      00742         banksel FSR
021B   0084           00743     movwf       FSR
                      00744         
021C   30FF           00745         movlw   0xFF                ;;  check dst adress1
021D   1283 1303      00746         banksel INDF
021F   0200           00747     subwf       INDF,W
0220   1D03           00748         btfss   STATUS,Z
0221   2???           00749         goto    recend_no_broadcast
                      00750 
0222   1283 1303      00751     banksel FSR
0224   0A04           00752         incf    FSR,W               ;;  Increase the address
0225   0084           00753         movwf   FSR
                      00754 
0226   30FF           00755         movlw   0xFF                ;;  check dst adress2
0227   1283 1303      00756         banksel INDF
0229   0200           00757     subwf       INDF,W
022A   1D03           00758         btfss   STATUS,Z
022B   2???           00759         goto    recend_no_broadcast
                      00760         
022C   3059           00761         movlw   rcframe+6        
022D   1283 1303      00762         banksel FSR
022F   0084           00763     movwf       FSR
0230   3001           00764         movlw   0x01
0231   1283 1303      00765     banksel INDF
0233   0200           00766         subwf   INDF,W
0234   1903           00767         btfsc   STATUS,Z
0235   2???           00768         goto    func_bc_01
                      00769 
                      00770 #ifdef  on_got_IAH
                      00771     movlw       0x03
                      00772     banksel INDF
                      00773         subwf   INDF,W
                      00774         btfss   STATUS,Z
                      00775         goto    restore
                      00776     banksel INDF
                      00777     incf    FSR, F
                      00778     movlw       0x01
                      00779     banksel INDF
                      00780         subwf   INDF,W
                      00781         btfss   STATUS,Z
                      00782         goto    restore
                      00783     goto    on_got_IAH
                      00784 #endif
0236   2???           00785         goto    restore
                      00786 
0237                  00787 func_bc_01:
MPASM  5.50  /HOME/MOONSHINE/SPEEDBUS/PIC/MPL   3-24-2014  15:36:40         PAGE 17


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0237   3058           00788     movlw       rcframe+5
0238   1283 1303      00789         banksel FSR
023A   0084           00790     movwf       FSR
023B   3001           00791         movlw   0x01
023C   1283 1303      00792     banksel INDF
023E   0200           00793         subwf   INDF,W
023F   1903           00794         btfsc   STATUS,Z
0240   2???           00795     goto    func_bc_sendaddr
0241   3000           00796     movlw       0x00
0242   0200           00797     subwf       INDF,W
0243   1903           00798         btfsc   STATUS,Z
0244   2???           00799     call    func_send_response
0245   2???           00800     goto    restore
                      00801 
                      00802 
0246                  00803 func_bc_sendaddr:       
0246   2???           00804         call    trd                 ;; Three random delay:s before ansor broadcast
                      00805 
0247   2???           00806     call    func_set_rsp_addr   ;; Set rsp_adress to the src adress of the last recived package
                      00807 
                      00808         ;; Send Package:
0248   1283 1303      00809         banksel framelen
024A   300B           00810         movlw   11
024B   00BB           00811         movwf   framelen
                      00812 
                      00813         ;; dst adress
024C   0831           00814         movf    rsp_adress1,W
024D   00BE           00815         movwf   txframe
                      00816 
                      00817         ;; dst adress
024E   0832           00818         movf    rsp_adress2,W
024F   00BF           00819         movwf   txframe+1
                      00820 
                      00821         ;; * my own src adress
0250   0833           00822         movf    adress1, W
0251   00C0           00823         movwf   txframe+2
                      00824 
                      00825         ;; * my own src adress
0252   0834           00826         movf    adress2, W
0253   00C1           00827         movwf   txframe+3
                      00828 
                      00829         ;; 0x03 control bit
0254   3003           00830         movlw   0x03
0255   00C2           00831         movwf   txframe+4
                      00832 
                      00833         ;; 0x01 protocoll
0256   3001           00834     movlw   0x01
0257   00C3           00835         movwf   txframe+5
                      00836 
                      00837         ;; Data
0258   3001           00838     movlw       0x01
0259   00C4           00839         movwf   txframe+6
                      00840 
MPASM  5.50  /HOME/MOONSHINE/SPEEDBUS/PIC/MPL   3-24-2014  15:36:40         PAGE 18


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00841     ;; Data - DeviceID
025A   3040           00842     movlw   DEV_ID1
025B   00C5           00843         movwf   txframe+7
                      00844 
                      00845         ;; Data - DeviceID
025C   3032           00846     movlw       DEV_ID2
025D   00C6           00847         movwf   txframe+8
                      00848 
                      00849         ;; Padding bit
025E   3000           00850         movlw   0x00
025F   00C7           00851     movwf   txframe+9
                      00852         
                      00853         ;; This is a broadcast package with adress on it
0260   3001           00854         movlw   0x01
0261   0258           00855         subwf   rcframe+5,W
0262   1903           00856         btfsc   STATUS,Z
0263   2???           00857     goto    handle_response
0264   2???           00858     call    txdo
                      00859 
0265   2???           00860         goto    restore
                      00861 
0266                  00862 func_send_iam_here:             ;; IMPORTANT, this function "return", use "call func_send_iam_here"
0266   300C           00863         movlw   12
0267   1283 1303      00864     banksel framelen
0269   00BB           00865         movwf   framelen
                      00866 
026A   30FF           00867     movlw   0xFF
026B   00BE           00868         movwf   txframe
                      00869 
026C   30FF           00870     movlw   0xFF
026D   00BF           00871         movwf   txframe+1
                      00872 
                      00873     ;; * my own src adress
026E   0833           00874         movf    adress1, W
026F   00C0           00875         movwf   txframe+2
                      00876 
                      00877     ;; * my own src adress
0270   0834           00878         movf    adress2, W
0271   00C1           00879         movwf   txframe+3
                      00880 
                      00881     ;; 0x03 control bit
0272   3003           00882         movlw   0x03
0273   00C2           00883         movwf   txframe+4
                      00884 
                      00885     ;; 0x01     protocoll
0274   3000           00886     movlw   0x00
0275   00C3           00887         movwf   txframe+5
                      00888 
                      00889     ;; Data
0276   3003           00890     movlw       0x03
0277   00C4           00891         movwf   txframe+6
                      00892 
                      00893     ;; 0x00 Basic config response
MPASM  5.50  /HOME/MOONSHINE/SPEEDBUS/PIC/MPL   3-24-2014  15:36:40         PAGE 19


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0278   3001           00894         movlw   0x01
0279   00C5           00895     movwf   txframe+7
                      00896 
                      00897     ;; Data - DeviceID
027A   3040           00898     movlw   DEV_ID1
027B   00C6           00899         movwf   txframe+8
                      00900 
                      00901     ;; Data - DeviceID
027C   3032           00902     movlw       DEV_ID2
027D   00C7           00903         movwf   txframe+9
                      00904         ;; Padding bit
027E   3000           00905         movlw   0x00
027F   00C8           00906     movwf   txframe+10
                      00907 
0280   2???           00908     call    txdo
0281   0008           00909     return  
                      00910 
0282                  00911 func_rand_addr:
0282   1283 1303      00912     banksel rand
0284   082A           00913     movf    rand,W
0285   00B3           00914     movwf   adress1
0286   2???           00915     call    lfsr_func
0287   1283 1303      00916     banksel rand
0289   082A           00917     movf    rand,W
028A   00B4           00918     movwf   adress2
028B   0008           00919     return
                      00920 
028C                  00921 func_setport:
028C   3002           00922         movlw   2
028D   1283 1303      00923     banksel FSR
028F   0784           00924         addwf   FSR,F
0290   1283 1303      00925     banksel INDF
0292   0800           00926         movf    INDF,W
                      00927 #ifdef PORTC
0293   1283 1303      00928     banksel PORTC
0295   0087           00929         movwf   PORTC
                      00930 #endif
0296   2???           00931         goto    restore
                      00932 
0297                  00933 func_set_rsp_addr:
                      00934     ;; Add last rec package src addr to rsp_adress1 rsp_adress2
0297   3055           00935     movlw       rcframe+2
0298   1283 1303      00936     banksel FSR
029A   0084           00937         movwf   FSR
029B   1283 1303      00938     banksel INDF
029D   0800           00939     movf    INDF,W
029E   1283 1303      00940     banksel rsp_adress1
02A0   00B1           00941     movwf   rsp_adress1
                      00942 
02A1   3056           00943         movlw   rcframe+3
02A2   1283 1303      00944     banksel FSR
02A4   0084           00945         movwf   FSR
02A5   1283 1303      00946     banksel INDF
MPASM  5.50  /HOME/MOONSHINE/SPEEDBUS/PIC/MPL   3-24-2014  15:36:40         PAGE 20


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

02A7   0800           00947     movf    INDF,W
02A8   1283 1303      00948     banksel rsp_adress2
02AA   00B2           00949     movwf   rsp_adress2
02AB   0008           00950     return
                      00951 
02AC                  00952 handle_response:
02AC   1283 1303      00953     banksel rc_listen
02AE   11AD           00954     bcf     rc_listen,3
02AF   14B6           00955     bsf     speedlib_main,1
02B0   10AD           00956     bcf rc_listen,1
                      00957 
                      00958     ;; Important, this should be run in "main space", not interupt space, soo,
                      00959     ;; well, now it is runed somewheare in the middle, wait for response STATE
02B1   1283 1303      00960     banksel INTCON
02B3   178B           00961     bsf     INTCON,GIE
02B4   300A           00962     movlw   10
02B5   1283 1303      00963     banksel rsp_adress1
02B7   00B1           00964     movwf   rsp_adress1
                      00965 
02B8                  00966 handle_response_loop:
02B8   2???           00967     call    txdo
02B9   30FA           00968         movlw   250
02BA   2???           00969         call    Delay
                      00970 
                      00971     ;; If error
02BB   1283 1303      00972     banksel RCSTA
02BD   1898           00973         btfsc   RCSTA,OERR
02BE   2???           00974         call    recerror
                      00975     ;;
                      00976 
02BF   1283 1303      00977     banksel rc_listen
02C1   19AD           00978     btfsc   rc_listen,3
02C2   2???           00979     goto    handle_response_ret
02C3   0BB1           00980     decfsz  rsp_adress1,f
02C4   2???           00981     goto    handle_response_loop
                      00982 
02C5                  00983 handle_response_ret:
02C5   11AD           00984     bcf     rc_listen,3
02C6   10B6           00985     bcf     speedlib_main,1
02C7   2???           00986     goto    restore
                      00987 
02C8                  00988 reccrcfail:
                      00989         ;; Because that this happend directrly after a crc-fail, here we need to clear the counter, so t
                            he next comming package will start allover
02C8   1283 1303      00990     banksel rc_counter
02CA   3005           00991     movlw   5
02CB   022E           00992     subwf   rc_counter,W
02CC   1C03           00993     btfss   STATUS,C
02CD   2???           00994     goto    reccrcfail_end
                      00995 
02CE   30FA           00996     movlw    250
02CF   2???           00997     call    Delay
                      00998 
MPASM  5.50  /HOME/MOONSHINE/SPEEDBUS/PIC/MPL   3-24-2014  15:36:40         PAGE 21


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

02D0                  00999 reccrcfail_end:
02D0   1283 1303      01000     banksel rc_counter
02D2   01AE           01001     clrf        rc_counter
02D3   2???           01002         goto    restore
                      01003         
02D4                  01004 recerror:
                      01005         ;; Do somthing
02D4   1283 1303      01006     banksel RCSTA
02D6   1218           01007         bcf     RCSTA,CREN
02D7   1618           01008         bsf     RCSTA,CREN
02D8   0008           01009         return
                      01010 
02D9                  01011 txoops:
                      01012     ;; Colisson has ocurred
02D9   1283 1303      01013     banksel rc_listen
02DB   10AD           01014     bcf     rc_listen,1
02DC   10BD           01015         bcf     txreturn,1
02DD   2???           01016         call    lfsr_func
02DE   1283 1303      01017     banksel rand
02E0   082A           01018         movf    rand,W
02E1   2???           01019         call    Delay
02E2   2???           01020         goto    txdo2
                      01021 
02E3                  01022 tx_send:
02E3   1283 1303      01023     banksel txtmp
02E5   00BC           01024         movwf   txtmp
02E6   307E           01025         movlw   0x7e            
02E7   023C           01026         subwf   txtmp,W         
02E8   1903           01027         btfsc   STATUS,Z
02E9   2???           01028         goto    tx_send_escape_1
                      01029 
02EA   307D           01030         movlw   0x7d
02EB   023C           01031         subwf   txtmp,W
02EC   1903           01032         btfsc   STATUS,Z
02ED   2???           01033         goto    tx_send_escape_2
02EE   083C           01034         movf    txtmp,W
                      01035         
02EF                  01036 tx_send_noescape:
02EF   1283 1303      01037     banksel txtmp
02F1   00BC           01038     movwf       txtmp
                      01039 
02F2   1283 1303      01040     banksel rc_listen
02F4   14AD           01041     bsf     rc_listen,1
                      01042 
02F5   1283 1303      01043     banksel txtmp
02F7   083C           01044     movf        txtmp,W
02F8   00AF           01045     movwf       rc_nocoll
02F9   1283 1303      01046     banksel TXREG
02FB   0099           01047     movwf       TXREG
                      01048 
02FC   1683 1303      01049     banksel TXSTA
02FE                  01050 tx_send_noescape_l:
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
MPASM  5.50  /HOME/MOONSHINE/SPEEDBUS/PIC/MPL   3-24-2014  15:36:40         PAGE 22


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

02FE   1C98           01051     btfss   TXSTA,TRMT
02FF   2???           01052     goto        tx_send_noescape_l
                      01053 
0300   1283 1303      01054     banksel d1
0302   3090           01055     movlw   0x90
0303   00A0           01056     movwf   d1
0304                  01057 tx_send_noescape_k:
0304   0BA0           01058     decfsz  d1,f
0305   2???           01059     goto    tx_send_noescape_k
0306   0008           01060         return
                      01061 
0307                  01062 tx_send_escape_1:
0307   307D           01063         movlw   0x7d
0308   2???           01064         call    tx_send_noescape
0309   305E           01065         movlw   0x5e
030A   2???           01066         call    tx_send_noescape
030B   0008           01067         return
                      01068 
030C                  01069 tx_send_escape_2:
030C   307D           01070         movlw   0x7d
030D   2???           01071         call    tx_send_noescape
030E   305D           01072         movlw   0x5d
030F   2???           01073         call    tx_send_noescape
0310   0008           01074         return
                      01075         
0311                  01076 txdo:                           
                      01077     ;; This is like the function argumnents, they need to be set at every presense of crcloopr
0311   1283 1303      01078     banksel framelen
0313   083B           01079         movf    framelen,W
0314   14AD           01080     bsf     rc_listen,1
0315   00B9           01081         movwf   crcloop
0316   303E           01082         movlw   txframe
0317   1283 1303      01083     banksel FSR
0319   0084           01084         movwf   FSR
031A   1283 1303      01085     banksel crc0
031C   01B7           01086         clrf    crc0
031D   01B8           01087         clrf    crc1
031E   2???           01088         call    crcloopr
031F   2???           01089         goto    txdo2
0320                  01090 crcloopr:
0320   1283 1303      01091     banksel crcloop
0322   0BB9           01092         decfsz  crcloop, f
0323   2???           01093         goto    crccalc
0324   0008           01094         return
                      01095 
0325                  01096 crccalc:
0325   1283 1303      01097     banksel INDF
0327   0800           01098         movf    INDF,W              ;; Load W with next databyte
0328   1283 1303      01099     banksel crc1
032A   0638           01100         xorwf   crc1,W              ;;(a^x):(b^y)
032B   00BA           01101         movwf   crctmp              ;;
032C   39F0           01102         andlw   0xf0                ;; W = (a^x):0
032D   0EBA           01103         swapf   crctmp,F            ;; Index = (b^y):(a^x)
MPASM  5.50  /HOME/MOONSHINE/SPEEDBUS/PIC/MPL   3-24-2014  15:36:40         PAGE 23


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

032E   06BA           01104         xorwf   crctmp,F            ;; Index = (a^b^x^y):(a^x) = i2:i1
                      01105 
                      01106                                 ;; High byte
032F   083A           01107         movf    crctmp,W
0330   39F0           01108         andlw   0xf0
0331   0637           01109         xorwf   crc0,W
0332   00B8           01110         movwf   crc1
                      01111 #ifdef  ARC_18F
                      01112     rlcf    crctmp,W            ;; use rlf for PIC18
                      01113         rlcf    crctmp,W            ;; use rlf for PIC18
                      01114 #endif
                      01115 #ifdef  ARC_16F
0333   0D3A           01116         rlf     crctmp,W            ;; use rlf for PIC16
0334   0D3A           01117         rlf     crctmp,W            ;; use rlf for PIC16
                      01118 #endif
                      01119 #ifdef  ARC_12F
                      01120         rlf     crctmp,W            ;; use rlf for PIC12
                      01121         rlf     crctmp,W            ;; use rlf for PIC12
                      01122 #endif
0335   06B8           01123         xorwf   crc1,F
0336   39E0           01124         andlw   0xe0
0337   06B8           01125         xorwf   crc1,F
                      01126 
0338   0EBA           01127         swapf   crctmp,F
0339   063A           01128         xorwf   crctmp,W
033A   00B7           01129         movwf   crc0
033B   1283 1303      01130     banksel FSR
033D   0A04           01131     incf    FSR,W
033E   0084           01132         movwf   FSR
033F   2???           01133         goto    crcloopr
                      01134 
0340                  01135 txdo2:
                      01136     ;; Set TX enable
0340   1283 1303      01137     banksel OUTREG
0342   1606           01138         bsf     OUTREG,OUTNUM
                      01139         ;;
0343   1283 1303      01140     banksel rc_listen
0345   14AD           01141     bsf     rc_listen,1
0346   307E           01142         movlw   0x7e
0347   2???           01143         call    tx_send_noescape
0348   1283 1303      01144         banksel txframe
034A   303E           01145     movlw       txframe
034B   1283 1303      01146     banksel FSR
034D   0084           01147         movwf   FSR
034E   1283 1303      01148     banksel framelen
0350   083B           01149         movf    framelen,W
0351   00B9           01150         movwf   crcloop
0352                  01151 send:
0352   1283 1303      01152     banksel crcloop
0354   0BB9           01153         decfsz  crcloop,f
0355   2???           01154         goto    lopp
0356   2???           01155         goto    crcsend
0357                  01156 lopp:
MPASM  5.50  /HOME/MOONSHINE/SPEEDBUS/PIC/MPL   3-24-2014  15:36:40         PAGE 24


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0357   1283 1303      01157     banksel INDF
0359   0800           01158         movf    INDF,W
035A   2???           01159         call    tx_send
035B   1283 1303      01160     banksel FSR
035D   0A84           01161         incf    FSR,F
035E   2???           01162         goto    send
                      01163 
035F                  01164 crcsend:
035F   1283 1303      01165     banksel crc0
0361   0837           01166         movf    crc0,W
0362   2???           01167         call    tx_send
0363   1283 1303      01168     banksel crc1
0365   0838           01169         movf    crc1,W
0366   2???           01170         call    tx_send
0367   2???           01171         goto    endflag
                      01172 
0368                  01173 endflag:
0368   307E           01174         movlw   0x7e
0369   2???           01175         call    tx_send_noescape
036A   1683 1303      01176     banksel TXSTA
036C                  01177 endflag_l:
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
036C   1C98           01178         btfss   TXSTA,TRMT
036D   2???           01179         goto    endflag_l
036E   1283 1303      01180     banksel txreturn
0370   18BD           01181     btfsc       txreturn,1          ;; Cant allow this rutine, the device sends back flags and crc, but 
                            the rest is zeroes (?)
0371   2???           01182     goto        txoops
0372   10AD           01183     bcf     rc_listen,1
                      01184 
                      01185     ;; Disable TX enable
0373   1283 1303      01186     banksel OUTREG
0375   1206           01187         bcf     OUTREG,OUTNUM
                      01188 
0376   0008           01189         return
                      01190 
0377                  01191 trd:
                      01192     ;; Three random delays before sending broadcast
0377   2???           01193         call    lfsr_func               
0378   1283 1303      01194     banksel rand
037A   082A           01195         movf    rand,W
037B   2???           01196         call    Delay
037C   2???           01197         call    lfsr_func
037D   1283 1303      01198     banksel rand
037F   082A           01199         movf    rand,W
0380   2???           01200         call    Delay
0381   2???           01201         call    lfsr_func
0382   1283 1303      01202     banksel rand
0384   082A           01203         movf    rand,W
0385   2???           01204         call    Delay
0386   0008           01205         return
                      01206         
0387                  01207 lfsr_func:
MPASM  5.50  /HOME/MOONSHINE/SPEEDBUS/PIC/MPL   3-24-2014  15:36:40         PAGE 25


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0387   1283 1303      01208     banksel rand
                      01209 #ifdef  ARC_18F
                      01210     rlcf     rand,W
                      01211         rlcf     rand,W
                      01212 #endif
                      01213 #ifdef  ARC_16F
0389   0D2A           01214         rlf     rand,W
038A   0D2A           01215         rlf     rand,W
                      01216 #endif
                      01217 #ifdef  ARC_12F
                      01218         rlf     rand,W
                      01219         rlf     rand,W
                      01220 #endif
038B   1A2A           01221         btfsc   rand,4
038C   3A01           01222         xorlw   1
038D   1AAA           01223         btfsc   rand,5
038E   3A01           01224         xorlw   1
038F   19AA           01225         btfsc   rand,3
0390   3A01           01226         xorlw   1
0391   00AA           01227         movwf   rand
0392   3400           01228         retlw   0
                      01229         
0393                  01230 Delay:
0393   1283 1303      01231     banksel d1
                      01232         ;; 499994 cycles
0395   00A2           01233         movwf   d3
0396   30FF           01234         movlw   0xFF
0397   00A1           01235         movwf   d2
0398   3032           01236         movlw   50
0399   00A0           01237         movwf   d1
039A                  01238 Delay_0:
039A   0BA0           01239         decfsz  d1, f
039B   2???           01240         goto    Delay_0
039C   3014           01241         movlw   20                  ;; Need this for tuning
039D   00A0           01242         movwf   d1
039E   0BA1           01243         decfsz  d2, f
039F   2???           01244         goto    Delay_0
03A0   3064           01245         movlw   100
03A1   00A1           01246         movwf   d2
03A2   0BA2           01247         decfsz  d3, f
03A3   2???           01248         goto    Delay_0
03A4   0008           01249         return
                      00027 
                      00028         ;;      __config  _FCMEN_OFF& _IESO_OFF& _MCLRE_OFF& _WDT_OFF& _INTOSCIO
                      00029 ;;;
                      00030 ;;;    _FCMEN_OFF           ; -- fail safe clock monitor enable off
                      00031 ;;;    _IESO_OFF            ; -- int/ext switch over enable off
                      00032 ;;;    _BOR_ON              ; default, brown out reset on
                      00033 ;;;    _CPD_OFF             ; default, data eeprom protection off
                      00034 ;;;    _CP_OFF              ; default, program code protection off
                      00035 ;;;    _MCLR_OFF            ; -- use MCLR pin as digital input
                      00036 ;;;    _PWRTE_OFF           ; default, power up timer off
                      00037 ;;;    _WDT_OFF             ; -- watch dog timer off
MPASM  5.50  /HOME/MOONSHINE/SPEEDBUS/PIC/MPL   3-24-2014  15:36:40         PAGE 26


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00038 ;;;    _INTOSCIO            ; -- internal osc, RA6 and RA7 I/O
                      00039 ;;;
                      00040 
                      00041 ;;;  --< constants >---------------------------------------------------
                      00042 
                      00043         radix dec
                      00044 
  00000008            00045 clock   equ     8       ; 8 MHz
  00004B00            00046 baud    equ     19200  ; 19200, 57600, or 115200
  00000004            00047 brgdiv  equ     4       ; divider value for BRG16 = 1
  00000067            00048 brgval  equ     (clock*10000000/baud/brgdiv+5)/10-1
                      00049 
                      00050 
                      00051         cblock  USER_VARIABLE_SPACE
  00000067            00052     pair
  00000068            00053     pair_c
  00000069            00054     w1
  0000006A            00055     w2
  0000006B            00056     w3
  0000006C            00057     w4
  0000006D            00058     main_commands          ; |X-------|b7 = NoNE
                      00059                            ; |-X------|b6 = NoNE
                      00060                            ; |--X-----|b5 = NoNE
                      00061                            ; |---X----|b4 = NoNE
                      00062                            ; |----X---|b3 = NoNE
                      00063                            ; |-----X--|b2 = NoNE
                      00064                            ; |------X-|b1 = If you set this to one, then the main loop will send back al
                            l the tags.
                      00065                            ; |-------X|b0 = If you set this to one, the next tag readed will be sent to 
                            the bus.
  0000006E            00066     w_loop_i
  0000006F            00067     w_tmp
  00000070            00068     w_hresp_loop
  00000071            00069     w_hresp_addr1
  00000072            00070     w_hresp_addr2
  00000073            00071     dd1
  00000074            00072     dd2
  00000075            00073     dd3
                      00074         endc
                      00075 
                      00076         org     0x000
0000   2???           00077         goto    v_reset
                      00078         org     0x004
0004   2???           00079         goto    intserv
                      00080 
                      00081 
0005                  00082 v_reset:
0005   0183           00083                   clrf    STATUS ; force bank 0 and IRP = 0        |B0
0006   1283 1303      00084               banksel INTCON
0008   138B           00085               bcf         INTCON, GIE
0009   2???           00086                   goto    Init   ;                                 |B0
                      00087 
                      00088         ;; ******************************************************************
MPASM  5.50  /HOME/MOONSHINE/SPEEDBUS/PIC/MPL   3-24-2014  15:36:40         PAGE 27


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00089         ;;   main init                                                      *
                      00090         ;; ******************************************************************
                      00091 
000A                  00092 Init:
                      00093 
000A   1283 1703      00094               banksel ANSEL
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
000C   019E           00095                   clrf    ANSEL      ; turn off ADC pins               |B2
000D   1283 1703      00096                   banksel ANSELH
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
000F   019F           00097               clrf    ANSELH     ; turn off ADC pins               |B2
                      00098 
0010   1683 1303      00099              banksel ADCON1
0012   3060           00100              MOVLW B'01100000'
                      00101              ;A/D RC clock
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0013   009F           00102              MOVWF ADCON1
                      00103              ;banksel ANSEL
                      00104              ;BSF ANSEL,3
                      00105              ;BSF ANSEL,7
                      00106 
                      00107         ;;
                      00108         ;;   setup 8 MHz INTOSC
                      00109         ;;
0014   1683 1303      00110               banksel OSCCON
                      00111 
0016   3070           00112                   movlw   b'01110000' ; '01110000'                      |B1
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0017   008F           00113                   movwf   OSCCON      ;                                 |B1
0018                  00114 Stable:
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0018   1D0F           00115                   btfss   OSCCON,HTS ; osc stable? yes, skip, else     |B1
0019   2???           00116                   goto    Stable     ; test again                      |B1
                      00117         ;;
                      00118         ;;   setup ports
                      00119         ;;
001A   1683 1303      00120             banksel TRISA
001C   30FF           00121                   movlw b'11111111'
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
001D   0085           00122                   movwf TRISA   ; Make PortA all input
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
001E   0186           00123                   clrf    TRISB ; setup PORT B all outputs        |B1
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
001F   0187           00124                   clrf    TRISC ; setup PORT C all outputs        |B1
                      00125               ;bsf     TRISC, 2
                      00126               ;bsf     TRISC, 3
                      00127     ;;
                      00128         ;; Set interupts
                      00129         ;;
0020   1683 1303      00130         banksel PIE1
0022   3020           00131                 movlw   b'00100000'
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0023   008C           00132                 movwf   PIE1
MPASM  5.50  /HOME/MOONSHINE/SPEEDBUS/PIC/MPL   3-24-2014  15:36:40         PAGE 28


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00133 
                      00134         ;;
                      00135         ;;   setup UART module for 19200 baud (8 MHz Clock)
                      00136         ;;
0024   1683 1303      00137               banksel SPBRG
0026   3067           00138                   movlw   low(brgval) ;                                 |B1
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0027   0099           00139                   movwf   SPBRG       ;                                 |B1
0028   1683 1303      00140                   banksel SPBRGH
002A   3000           00141               movlw   high(brgval) ;                                 |B1
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
002B   009A           00142                   movwf   SPBRGH       ;                                 |B1
002C   1683 1303      00143               banksel BAUDCTL
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
002E   159B           00144                   bsf     BAUDCTL,BRG16 ; select 16 bit BRG               |B1
002F   1683 1303      00145                   banksel TXSTA
0031   3024           00146               movlw   b'00100100'       ; '0-------' CSRC, n/a (async)    |B1
                      00147         ;;  '-0------' TX9 off, 8 bits      |B1
                      00148         ;;  '--1-----' TXEN, tx enabled     |B1
                      00149         ;;  '---0----' SYNC, async mode     |B1
                      00150         ;;  '----0---' SENDB, send brk      |B1
                      00151         ;;  '-----1--' BRGH, high speed     |B1
                      00152         ;;  '------00' TRMT, TX9D           |B1
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0032   0098           00153                   movwf   TXSTA ;                                 |B1
0033   1283 1303      00154               banksel RCSTA
0035   3090           00155                   movlw   b'10010000' ; '1-------' SPEN, port enabled   |B0
                      00156         ;;  '-0------' RX9 off, 8 bits      |B0
                      00157         ;;  '--0-----' SREN, n/a (async)    |B0
                      00158         ;;  '---1----' CREN, rx enabled     |B0
                      00159         ;;  '----0---' ADDEN off            |B0
                      00160         ;;  '-----000' FERR, OERR, RX9D     |B0
0036   0098           00161                   movwf   RCSTA ;                                 |B0
0037   081A           00162                   movf    RCREG,W ; flush Rx Buffer                 |B0
0038   081A           00163                   movf    RCREG,W ;                                 |B0
                      00164 
                      00165         ;;
                      00166         ;; SET RX/TX parameters
                      00167         ;;
0039   1283 1303      00168         banksel txreturn
003B   01BD           00169         clrf    txreturn
                      00170         ;;      Do not clear the adress:es, use the one that is set, read the speedbus text, "Adress han
                            deling system!"
                      00171         ;;      clrf    adress1
                      00172         ;;      movlw   0x7e
                      00173         ;;      movwf   adress1
                      00174         ;;      movlw   0x7d
                      00175         ;;      movwf   adress2
                      00176         ;;      clrf    adress1
                      00177         ;;      clrf    adress2
                      00178 
                      00179         ;;
                      00180         ;; Set Interrupts
MPASM  5.50  /HOME/MOONSHINE/SPEEDBUS/PIC/MPL   3-24-2014  15:36:40         PAGE 29


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00181         ;;
003C   1283 1303      00182         banksel INTCON
003E   178B           00183                 bsf     INTCON, GIE
003F   170B           00184                 bsf     INTCON, PEIE
0040   2???           00185         call    init_speedlib ; IMPORTANT to run this before, so the adresses are
                      00186                               ; imported from EEPROM
                      00187 
0041   1283 1303      00188         banksel PORTC
0043   1007           00189         bcf     PORTC, 0
0044   1787           00190         bsf     PORTC, 7
0045   1707           00191         bsf     PORTC, 6
                      00192 
0046   1283 1303      00193         banksel main_commands
0048   106D           00194         bcf     main_commands, 0
0049   10ED           00195         bcf     main_commands, 1
                      00196 
                      00197 
                      00198 
004A                  00199 main:
004A   1283 1303      00200     banksel RCSTA
004C   1898           00201         btfsc   RCSTA,OERR
004D   2???           00202         call    recerror
                      00203         ;btfsc  PORTA, 0
                      00204         ;call   txporta
004E   1283 1303      00205     banksel rand
0050   0AAA           00206         incf    rand,F          ; Increase the random value
                      00207 
0051   1283 1303      00208     banksel PORTA
0053   1C05           00209     btfss   PORTA, 0
0054   2???           00210     goto    read_wiegand
0055   1C85           00211     btfss   PORTA, 1
0056   2???           00212     goto    read_wiegand
                      00213 
0057   18ED           00214     btfsc   main_commands, 1
0058   2???           00215     call    list_rfids
                      00216 
0059   2???           00217     goto    main
                      00218 
                      00219 
005A                  00220 read_wiegand:
005A   1283 1303      00221     banksel INTCON
005C   138B           00222     bcf     INTCON, GIE
                      00223 
                      00224     ;; Get parity bit at first.
005D   1283 1303      00225     banksel PORTA
005F   1C05           00226     btfss   PORTA, 0
0060   1067           00227     bcf     pair, 0
0061   1C85           00228     btfss   PORTA, 1
0062   1467           00229     bsf     pair, 0
0063   2???           00230     call    read_wiegand_wait
0064   2???           00231     call    read_wiegand_delay
                      00232 
0065   306C           00233     movlw   w4
MPASM  5.50  /HOME/MOONSHINE/SPEEDBUS/PIC/MPL   3-24-2014  15:36:40         PAGE 30


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0066   0084           00234     movwf   FSR
                      00235 
0067   3004           00236     movlw   4
0068   00A2           00237     movwf   d3
0069                  00238 read_wiegand_loop1:
                      00239     ;; Write in bit 1
0069   1283 1303      00240     banksel PORTA
006B   1C05           00241     btfss   PORTA, 0
006C   1380           00242     bcf     INDF, 7
006D   1C85           00243     btfss   PORTA, 1
006E   1780           00244     bsf     INDF, 7
006F   2???           00245     call    read_wiegand_wait
0070   2???           00246     call    read_wiegand_delay
                      00247 
                      00248     ;; Write in bit 2
0071   1283 1303      00249     banksel PORTA
0073   1C05           00250     btfss   PORTA, 0
0074   1300           00251     bcf     INDF, 6
0075   1C85           00252     btfss   PORTA, 1
0076   1700           00253     bsf     INDF, 6
0077   2???           00254     call    read_wiegand_wait
0078   2???           00255     call    read_wiegand_delay
                      00256 
                      00257     ;; Write in bit 3
0079   1283 1303      00258     banksel PORTA
007B   1C05           00259     btfss   PORTA, 0
007C   1280           00260     bcf     INDF, 5
007D   1C85           00261     btfss   PORTA, 1
007E   1680           00262     bsf     INDF, 5
007F   2???           00263     call    read_wiegand_wait
0080   2???           00264     call    read_wiegand_delay
                      00265 
                      00266     ;; Write in bit 4
0081   1283 1303      00267     banksel PORTA
0083   1C05           00268     btfss   PORTA, 0
0084   1200           00269     bcf     INDF, 4
0085   1C85           00270     btfss   PORTA, 1
0086   1600           00271     bsf     INDF, 4
0087   2???           00272     call    read_wiegand_wait
0088   2???           00273     call    read_wiegand_delay
                      00274 
                      00275     ;; Write in bit 5
0089   1283 1303      00276     banksel PORTA
008B   1C05           00277     btfss   PORTA, 0
008C   1180           00278     bcf     INDF, 3
008D   1C85           00279     btfss   PORTA, 1
008E   1580           00280     bsf     INDF, 3
008F   2???           00281     call    read_wiegand_wait
0090   2???           00282     call    read_wiegand_delay
                      00283 
                      00284     ;; Write in bit 6
0091   1283 1303      00285     banksel PORTA
0093   1C05           00286     btfss   PORTA, 0
MPASM  5.50  /HOME/MOONSHINE/SPEEDBUS/PIC/MPL   3-24-2014  15:36:40         PAGE 31


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0094   1100           00287     bcf     INDF, 2
0095   1C85           00288     btfss   PORTA, 1
0096   1500           00289     bsf     INDF, 2
0097   2???           00290     call    read_wiegand_wait
0098   2???           00291     call    read_wiegand_delay
                      00292 
                      00293     ;; Write in bit 7
0099   1283 1303      00294     banksel PORTA
009B   1C05           00295     btfss   PORTA, 0
009C   1080           00296     bcf     INDF, 1
009D   1C85           00297     btfss   PORTA, 1
009E   1480           00298     bsf     INDF, 1
009F   2???           00299     call    read_wiegand_wait
00A0   2???           00300     call    read_wiegand_delay
                      00301 
                      00302     ;; Write in bit 8
00A1   1283 1303      00303     banksel PORTA
00A3   1C05           00304     btfss   PORTA, 0
00A4   1000           00305     bcf     INDF, 0
00A5   1C85           00306     btfss   PORTA, 1
00A6   1400           00307     bsf     INDF, 0
00A7   2???           00308     call    read_wiegand_wait
00A8   2???           00309     call    read_wiegand_delay
                      00310 
                      00311 
00A9   0384           00312     decf    FSR, f
00AA   0BA2           00313         decfsz  d3, f
00AB   2???           00314     goto    read_wiegand_loop1
                      00315 
                      00316     ;; Get parity bit at last.
00AC   1283 1303      00317     banksel PORTA
00AE   1C05           00318     btfss   PORTA, 0
00AF   10E7           00319     bcf     pair, 1
00B0   1C85           00320     btfss   PORTA, 1
00B1   14E7           00321     bsf     pair, 1
                      00322 
00B2   1283 1303      00323     banksel INTCON
00B4   178B           00324     bsf     INTCON, GIE
                      00325 
                      00326     ;; Parity check
00B5   1068           00327     bcf     pair_c, 0
00B6   14E8           00328     bsf     pair_c, 1
00B7   2???           00329     call    read_wiegand_pair_ceaven
00B8   2???           00330     call    read_wiegand_pair_codd
                      00331 
00B9   0867           00332     movf    pair, W
00BA   06E8           00333     xorwf   pair_c, f
                      00334 
00BB   1868           00335     btfsc   pair_c, 0
00BC   2???           00336     goto    read_wiegand_return
00BD   18E8           00337     btfsc   pair_c, 1
00BE   2???           00338     goto    read_wiegand_return
                      00339     ;;
MPASM  5.50  /HOME/MOONSHINE/SPEEDBUS/PIC/MPL   3-24-2014  15:36:40         PAGE 32


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00340 
00BF   186D           00341     btfsc   main_commands, 0
00C0   2???           00342     call    send_rfidnr
                      00343 
                      00344 
00C1   3005           00345     movlw   5
00C2   00EE           00346     movwf   w_loop_i
                      00347 
00C3                  00348 read_wiegand_seeprom_loop:
                      00349 
00C3   086E           00350     movf    w_loop_i, W
00C4   2???           00351     call    read_eeprom
00C5   00EF           00352     movwf    w_tmp
                      00353 
00C6   186F           00354     btfsc   w_tmp, 0
00C7   2???           00355     goto    read_wiegand_seeprom_loop_e
                      00356 
                      00357 
00C8   086E           00358     movf    w_loop_i, W
00C9   3E01           00359     addlw   1
00CA   2???           00360     call    read_eeprom
00CB   026C           00361     subwf       w4,W
00CC   1D03           00362     btfss       STATUS,Z
00CD   2???           00363     goto        read_wiegand_seeprom_loop_e
                      00364 
00CE   086E           00365     movf    w_loop_i, W
00CF   3E02           00366     addlw   2
00D0   2???           00367     call    read_eeprom
00D1   026B           00368     subwf       w3,W
00D2   1D03           00369     btfss       STATUS,Z
00D3   2???           00370     goto        read_wiegand_seeprom_loop_e
                      00371 
00D4   086E           00372     movf    w_loop_i, W
00D5   3E03           00373     addlw   3
00D6   2???           00374     call    read_eeprom
00D7   026A           00375     subwf       w2,W
00D8   1D03           00376     btfss       STATUS,Z
00D9   2???           00377     goto        read_wiegand_seeprom_loop_e
                      00378 
00DA   086E           00379     movf    w_loop_i, W
00DB   3E04           00380     addlw   4
00DC   2???           00381     call    read_eeprom
00DD   0269           00382     subwf       w1,W
00DE   1D03           00383     btfss       STATUS,Z
00DF   2???           00384     goto        read_wiegand_seeprom_loop_e
                      00385 
                      00386     ;; Got access
00E0   1387           00387     bcf     PORTC,  7
00E1   1407           00388     bsf     PORTC,  0
                      00389 
00E2   3014           00390     movlw   20
00E3   2???           00391     call    Delay
00E4   1307           00392     bcf     PORTC,  6
MPASM  5.50  /HOME/MOONSHINE/SPEEDBUS/PIC/MPL   3-24-2014  15:36:40         PAGE 33


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

00E5   3014           00393     movlw   20
00E6   2???           00394     call    Delay
00E7   1707           00395     bsf     PORTC,  6
                      00396 
00E8   3064           00397     movlw   100
00E9   2???           00398     call    Delay
00EA   1787           00399     bsf     PORTC,  7
00EB   3096           00400     movlw   150
00EC   2???           00401     call    Delay
00ED   1007           00402     bcf     PORTC,  0
                      00403     ;;
00EE   2???           00404     goto    read_wiegand_return
                      00405 
00EF                  00406 read_wiegand_seeprom_loop_e:
00EF   3005           00407     movlw   5
Message[305]: Using default destination of 1 (file).
00F0   07EE           00408     addwf   w_loop_i
                      00409 
00F1   0F6E           00410     incfsz  w_loop_i, w
00F2   2???           00411     goto    read_wiegand_seeprom_loop
                      00412 
00F3                  00413 read_wiegand_return:
                      00414 
00F3   2???           00415     goto    main
                      00416 
00F4                  00417 read_wiegand_wait:
00F4   1283 1303      00418     banksel PORTA
00F6   1C05           00419     btfss   PORTA, 0
00F7   2???           00420     goto    read_wiegand_wait
00F8   1283 1303      00421     banksel PORTA
00FA   1C85           00422     btfss   PORTA, 1
00FB   2???           00423     goto    read_wiegand_wait
00FC   0008           00424     return
                      00425 
00FD                  00426 send_rfidnr:
                      00427     ;; Send the readed rfid
00FD   300D           00428         movlw   13
00FE   1283 1303      00429     banksel framelen
0100   00BB           00430         movwf   framelen
                      00431 
0101   0831           00432     movf    rsp_adress1, W
0102   00BE           00433         movwf   txframe
                      00434 
0103   0832           00435     movf    rsp_adress2, W
0104   00BF           00436         movwf   txframe+1
                      00437 
                      00438     ;; * my own src adress
0105   0833           00439         movf    adress1, W
0106   00C0           00440         movwf   txframe+2
                      00441 
                      00442     ;; * my own src adress
0107   0834           00443         movf    adress2, W
0108   00C1           00444         movwf   txframe+3
MPASM  5.50  /HOME/MOONSHINE/SPEEDBUS/PIC/MPL   3-24-2014  15:36:40         PAGE 34


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00445 
                      00446     ;; 0x03 control bit
0109   3003           00447         movlw   0x03
010A   00C2           00448         movwf   txframe+4
                      00449 
                      00450     ;; 0x01     protocoll
010B   3000           00451     movlw   0x00
010C   00C3           00452         movwf   txframe+5
                      00453 
                      00454     ;; Data
010D   300A           00455     movlw       0x0A
010E   00C4           00456         movwf   txframe+6
                      00457 
                      00458     ;; 0x00 Basic config response
010F   086C           00459         movf    w4, W
0110   00C5           00460     movwf   txframe+7
                      00461 
                      00462     ;; 0x00 Basic config response
0111   086B           00463         movf    w3, W
0112   00C6           00464     movwf   txframe+8
                      00465 
                      00466     ;; Data - DeviceID
0113   086A           00467     movf    w2, W
0114   00C7           00468         movwf   txframe+9
                      00469 
                      00470     ;; Data - DeviceID
0115   0869           00471     movf    w1, W
0116   00C8           00472         movwf   txframe+10
                      00473 
                      00474         ;; Padding bit
0117   3000           00475         movlw   0x00
0118   00C9           00476     movwf   txframe+11
0119   2???           00477     call    txdo
                      00478 
011A   106D           00479     bcf     main_commands, 0
                      00480 
011B   0008           00481     return
                      00482 
011C                  00483 read_wiegand_delay:
011C   3028           00484     movlw   40
011D   00A1           00485     movwf   d2
011E                  00486 read_wiegand_delay_loop:
011E   2???           00487     call    Delay_01_ms
011F   1283 1303      00488     banksel PORTA
0121   1C05           00489     btfss   PORTA, 0
0122   0008           00490     return
0123   1C85           00491     btfss   PORTA, 1
0124   0008           00492     return
0125   1283 1303      00493     banksel d2
0127   0BA1           00494         decfsz  d2, f
0128   2???           00495     goto    read_wiegand_delay_loop
0129   0008           00496     return
                      00497 
MPASM  5.50  /HOME/MOONSHINE/SPEEDBUS/PIC/MPL   3-24-2014  15:36:40         PAGE 35


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

012A                  00498 read_wiegand_pair_ceaven:
012A   1BEC           00499     btfsc   w4, 7
012B   2???           00500     call    read_wiegand_pari_c1
012C   1B6C           00501     btfsc   w4, 6
012D   2???           00502     call    read_wiegand_pari_c1
012E   1AEC           00503     btfsc   w4, 5
012F   2???           00504     call    read_wiegand_pari_c1
0130   1A6C           00505     btfsc   w4, 4
0131   2???           00506     call    read_wiegand_pari_c1
0132   19EC           00507     btfsc   w4, 3
0133   2???           00508     call    read_wiegand_pari_c1
0134   196C           00509     btfsc   w4, 2
0135   2???           00510     call    read_wiegand_pari_c1
0136   18EC           00511     btfsc   w4, 1
0137   2???           00512     call    read_wiegand_pari_c1
0138   186C           00513     btfsc   w4, 0
0139   2???           00514     call    read_wiegand_pari_c1
013A   1BEB           00515     btfsc   w3, 7
013B   2???           00516     call    read_wiegand_pari_c1
013C   1B6B           00517     btfsc   w3, 6
013D   2???           00518     call    read_wiegand_pari_c1
013E   1AEB           00519     btfsc   w3, 5
013F   2???           00520     call    read_wiegand_pari_c1
0140   1A6B           00521     btfsc   w3, 4
0141   2???           00522     call    read_wiegand_pari_c1
0142   19EB           00523     btfsc   w3, 3
0143   2???           00524     call    read_wiegand_pari_c1
0144   196B           00525     btfsc   w3, 2
0145   2???           00526     call    read_wiegand_pari_c1
0146   18EB           00527     btfsc   w3, 1
0147   2???           00528     call    read_wiegand_pari_c1
0148   186B           00529     btfsc   w3, 0
0149   2???           00530     call    read_wiegand_pari_c1
014A   0008           00531     return
                      00532 
014B                  00533 read_wiegand_pair_codd:
014B   1BEA           00534     btfsc   w2, 7
014C   2???           00535     call    read_wiegand_pari_c2
014D   1B6A           00536     btfsc   w2, 6
014E   2???           00537     call    read_wiegand_pari_c2
014F   1AEA           00538     btfsc   w2, 5
0150   2???           00539     call    read_wiegand_pari_c2
0151   1A6A           00540     btfsc   w2, 4
0152   2???           00541     call    read_wiegand_pari_c2
0153   19EA           00542     btfsc   w2, 3
0154   2???           00543     call    read_wiegand_pari_c2
0155   196A           00544     btfsc   w2, 2
0156   2???           00545     call    read_wiegand_pari_c2
0157   18EA           00546     btfsc   w2, 1
0158   2???           00547     call    read_wiegand_pari_c2
0159   186A           00548     btfsc   w2, 0
015A   2???           00549     call    read_wiegand_pari_c2
015B   1BE9           00550     btfsc   w1, 7
MPASM  5.50  /HOME/MOONSHINE/SPEEDBUS/PIC/MPL   3-24-2014  15:36:40         PAGE 36


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

015C   2???           00551     call    read_wiegand_pari_c2
015D   1B69           00552     btfsc   w1, 6
015E   2???           00553     call    read_wiegand_pari_c2
015F   1AE9           00554     btfsc   w1, 5
0160   2???           00555     call    read_wiegand_pari_c2
0161   1A69           00556     btfsc   w1, 4
0162   2???           00557     call    read_wiegand_pari_c2
0163   19E9           00558     btfsc   w1, 3
0164   2???           00559     call    read_wiegand_pari_c2
0165   1969           00560     btfsc   w1, 2
0166   2???           00561     call    read_wiegand_pari_c2
0167   18E9           00562     btfsc   w1, 1
0168   2???           00563     call    read_wiegand_pari_c2
0169   1869           00564     btfsc   w1, 0
016A   2???           00565     call    read_wiegand_pari_c2
016B   0008           00566     return
                      00567 
016C                  00568 read_wiegand_pari_c1:
016C   3001           00569     movlw    B'00000001'
016D   06E8           00570     xorwf    pair_c,F
016E   0008           00571     return
                      00572 
016F                  00573 read_wiegand_pari_c2:
016F   3002           00574     movlw    B'00000010'
0170   06E8           00575     xorwf    pair_c,F
0171   0008           00576     return
                      00577 
                      00578 
0172                  00579 custom_command_handler:
0172   300A           00580         movlw   0x0A            ;; Set the get tagg bit
0173   0200           00581         subwf   INDF,W
0174   1903           00582         btfsc   STATUS,Z
0175   2???           00583         goto    set_get_tag
                      00584 
0176   300B           00585         movlw   0x0B
0177   0200           00586         subwf   INDF,W
0178   1903           00587         btfsc   STATUS,Z
0179   2???           00588         goto    add_new_rfid
                      00589 
017A   300C           00590         movlw   0x0C
017B   0200           00591         subwf   INDF,W
017C   1903           00592         btfsc   STATUS,Z
017D   2???           00593         goto    rm_rfid
                      00594 
017E   300D           00595         movlw   0x0D
017F   0200           00596         subwf   INDF,W
0180   1903           00597         btfsc   STATUS,Z
0181   2???           00598         goto    list_rfids_dev
                      00599 
0182   2???           00600         goto    restore
                      00601 
0183                  00602 set_get_tag:
0183   1283 1303      00603         banksel main_commands
MPASM  5.50  /HOME/MOONSHINE/SPEEDBUS/PIC/MPL   3-24-2014  15:36:40         PAGE 37


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0185   146D           00604         bsf     main_commands, 0
0186   2???           00605         call    func_set_rsp_addr
0187   2???           00606         goto    restore
                      00607 
0188                  00608 add_new_rfid:
0188   1283 1303      00609         banksel loop2
                      00610 
018A   3005           00611         movlw   5
018B   00AC           00612         movwf   loop2
018C                  00613 add_new_rfid_loop:
                      00614 
018C   082C           00615         movf    loop2, W
018D   2???           00616         call    read_eeprom
018E   00AF           00617         movwf   rc_nocoll
                      00618 
018F   1C2F           00619         btfss   rc_nocoll, 0
0190   2???           00620         goto    add_new_rfid_loop_e
                      00621 
                      00622 
0191   082C           00623         movf    loop2, W
0192   00AF           00624         movwf   rc_nocoll
0193   3000           00625         movlw   0
0194   2???           00626         call    write_eeprom
                      00627 
0195   082C           00628         movf    loop2, W
0196   3E01           00629         addlw   1
0197   00AF           00630         movwf   rc_nocoll
0198   085A           00631         movf    rcframe+7, W
0199   2???           00632         call    write_eeprom
                      00633 
019A   082C           00634         movf    loop2, W
019B   3E02           00635         addlw   2
019C   00AF           00636         movwf   rc_nocoll
019D   085B           00637         movf    rcframe+8, W
019E   2???           00638         call    write_eeprom
                      00639 
019F   082C           00640         movf    loop2, W
01A0   3E03           00641         addlw   3
01A1   00AF           00642         movwf   rc_nocoll
01A2   085C           00643         movf    rcframe+9, W
01A3   2???           00644         call    write_eeprom
                      00645 
01A4   082C           00646         movf    loop2, W
01A5   3E04           00647         addlw   4
01A6   00AF           00648         movwf   rc_nocoll
01A7   085D           00649         movf    rcframe+10, W
01A8   2???           00650         call    write_eeprom
                      00651 
01A9   2???           00652         goto    restore
                      00653 
01AA                  00654 add_new_rfid_loop_e:
                      00655         ;; Check so that the rfid not already exists
                      00656 
MPASM  5.50  /HOME/MOONSHINE/SPEEDBUS/PIC/MPL   3-24-2014  15:36:40         PAGE 38


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

01AA   082C           00657         movf    loop2, W
01AB   3E01           00658         addlw   1
01AC   2???           00659         call    read_eeprom
01AD   00AB           00660         movwf   loop1
01AE   085A           00661         movf    rcframe+7, W
01AF   022B           00662         subwf   loop1,W
01B0   1D03           00663         btfss   STATUS,Z
01B1   2???           00664         goto    add_new_rfid_loop_ee
                      00665 
01B2   082C           00666         movf    loop2, W
01B3   3E02           00667         addlw   2
01B4   2???           00668         call    read_eeprom
01B5   00AB           00669         movwf   loop1
01B6   085B           00670         movf    rcframe+8, W
01B7   022B           00671         subwf   loop1,W
01B8   1D03           00672         btfss   STATUS,Z
01B9   2???           00673         goto    add_new_rfid_loop_ee
                      00674 
01BA   082C           00675         movf    loop2, W
01BB   3E03           00676         addlw   3
01BC   2???           00677         call    read_eeprom
01BD   00AB           00678         movwf   loop1
01BE   085C           00679         movf    rcframe+9, W
01BF   022B           00680         subwf   loop1,W
01C0   1D03           00681         btfss   STATUS,Z
01C1   2???           00682         goto    add_new_rfid_loop_ee
                      00683 
01C2   082C           00684         movf    loop2, W
01C3   3E04           00685         addlw   4
01C4   2???           00686         call    read_eeprom
01C5   00AB           00687         movwf   loop1
01C6   085D           00688         movf    rcframe+10, W
01C7   022B           00689         subwf   loop1,W
01C8   1D03           00690         btfss   STATUS,Z
01C9   2???           00691         goto    add_new_rfid_loop_ee
                      00692 
                      00693     ;; Got access
01CA   1387           00694     bcf     PORTC,  7
01CB   1407           00695     bsf     PORTC,  0
01CC   30FA           00696     movlw   250
01CD   2???           00697     call    Delay
01CE   30FA           00698     movlw   250
01CF   2???           00699     call    Delay
01D0   30FA           00700     movlw   250
01D1   2???           00701     call    Delay
01D2   1007           00702     bcf     PORTC,  0
01D3   1787           00703     bsf     PORTC,  7
                      00704     ;;
                      00705 
                      00706 
                      00707         ;; The rfid exists, return
01D4   2???           00708         goto    restore
                      00709 
MPASM  5.50  /HOME/MOONSHINE/SPEEDBUS/PIC/MPL   3-24-2014  15:36:40         PAGE 39


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

01D5                  00710 add_new_rfid_loop_ee:
01D5   3004           00711         movlw   4
Message[305]: Using default destination of 1 (file).
01D6   07AC           00712         addwf   loop2
                      00713 
01D7   0FAC           00714         incfsz  loop2, f
01D8   2???           00715         goto    add_new_rfid_loop
01D9   2???           00716         goto    restore
                      00717 
01DA                  00718 rm_rfid:
01DA   1283 1303      00719         banksel loop2
                      00720 
01DC   3005           00721         movlw   5
01DD   00AC           00722         movwf   loop2
01DE                  00723 rm_rfid_loop:
                      00724 
01DE   082C           00725         movf    loop2, W
01DF   2???           00726         call    read_eeprom
01E0   00AF           00727         movwf   rc_nocoll
                      00728 
01E1   182F           00729         btfsc   rc_nocoll, 0
01E2   2???           00730         goto    rm_rfid_loop_e
                      00731 
                      00732         ;; Find rfid
                      00733 
01E3   082C           00734         movf    loop2, W
01E4   3E01           00735         addlw   1
01E5   2???           00736         call    read_eeprom
01E6   00AB           00737         movwf   loop1
01E7   085A           00738         movf    rcframe+7, W
01E8   022B           00739         subwf   loop1,W
01E9   1D03           00740         btfss   STATUS,Z
01EA   2???           00741         goto    rm_rfid_loop_e
                      00742 
01EB   082C           00743         movf    loop2, W
01EC   3E02           00744         addlw   2
01ED   2???           00745         call    read_eeprom
01EE   00AB           00746         movwf   loop1
01EF   085B           00747         movf    rcframe+8, W
01F0   022B           00748         subwf   loop1,W
01F1   1D03           00749         btfss   STATUS,Z
01F2   2???           00750         goto    rm_rfid_loop_e
                      00751 
01F3   082C           00752         movf    loop2, W
01F4   3E03           00753         addlw   3
01F5   2???           00754         call    read_eeprom
01F6   00AB           00755         movwf   loop1
01F7   085C           00756         movf    rcframe+9, W
01F8   022B           00757         subwf   loop1,W
01F9   1D03           00758         btfss   STATUS,Z
01FA   2???           00759         goto    rm_rfid_loop_e
                      00760 
                      00761         ;; Remove rfid
MPASM  5.50  /HOME/MOONSHINE/SPEEDBUS/PIC/MPL   3-24-2014  15:36:40         PAGE 40


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

01FB   082C           00762         movf    loop2, W
01FC   00AF           00763         movwf   rc_nocoll
01FD   30FF           00764         movlw   0xFF
01FE   2???           00765         call    write_eeprom
                      00766 
01FF   082C           00767         movf    loop2, W
0200   3E01           00768         addlw   1
0201   00AF           00769         movwf   rc_nocoll
0202   30FF           00770         movlw   0xFF
0203   2???           00771         call    write_eeprom
                      00772 
0204   082C           00773         movf    loop2, W
0205   3E02           00774         addlw   2
0206   00AF           00775         movwf   rc_nocoll
0207   30FF           00776         movlw   0xFF
0208   2???           00777         call    write_eeprom
                      00778 
0209   082C           00779         movf    loop2, W
020A   3E03           00780         addlw   3
020B   00AF           00781         movwf   rc_nocoll
020C   30FF           00782         movlw   0xFF
020D   2???           00783         call    write_eeprom
                      00784         ;;
                      00785 
                      00786         ;; The rfid exists, return
020E   2???           00787         goto    restore
                      00788 
020F                  00789 rm_rfid_loop_e:
020F   3005           00790         movlw   5
Message[305]: Using default destination of 1 (file).
0210   07AC           00791         addwf   loop2
                      00792 
0211   0F2C           00793         incfsz  loop2, w
0212   2???           00794         goto    rm_rfid_loop
0213   2???           00795         goto    restore
                      00796 
0214                  00797 list_rfids_dev:
0214   1283 1303      00798         banksel main_commands
0216   18ED           00799         btfsc   main_commands, 1
0217   2???           00800         goto    restore                          ;; Device busy
                      00801 
0218   2???           00802         call    func_set_rsp_addr
0219   1283 1303      00803         banksel rsp_adress1
021B   0831           00804         movf    rsp_adress1, W
021C   00F1           00805         movwf   w_hresp_addr1
021D   0832           00806         movf    rsp_adress2, W
021E   00F2           00807         movwf   w_hresp_addr2
021F   14ED           00808         bsf     main_commands, 1
0220   2???           00809         goto    restore
                      00810 
                      00811 
                      00812 
0221                  00813 list_rfids:
MPASM  5.50  /HOME/MOONSHINE/SPEEDBUS/PIC/MPL   3-24-2014  15:36:40         PAGE 41


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0221   3005           00814         movlw   5
0222   00EE           00815         movwf   w_loop_i
                      00816 
0223                  00817 list_rfids_loop:
0223   086E           00818         movf    w_loop_i, W
0224   2???           00819         call    read_eeprom
0225   00EF           00820         movwf    w_tmp
                      00821 
0226   186F           00822         btfsc   w_tmp, 0
0227   2???           00823         goto    list_rfids_loop_e
                      00824 
                      00825         ;; Send the readed rfid
0228   300D           00826         movlw   13
0229   1283 1303      00827         banksel framelen
022B   00BB           00828         movwf   framelen
                      00829 
022C   0871           00830         movf    w_hresp_addr1, W
022D   00BE           00831         movwf   txframe
                      00832 
022E   0872           00833         movf    w_hresp_addr2, W
022F   00BF           00834         movwf   txframe+1
                      00835 
                      00836         ;; * my own src adress
0230   0833           00837         movf    adress1, W
0231   00C0           00838         movwf   txframe+2
                      00839 
                      00840         ;; * my own src adress
0232   0834           00841         movf    adress2, W
0233   00C1           00842         movwf   txframe+3
                      00843 
                      00844         ;; 0x03 control bit
0234   3003           00845         movlw   0x03
0235   00C2           00846         movwf   txframe+4
                      00847 
                      00848         ;; 0x01 protocoll
0236   3001           00849         movlw   0x01
0237   00C3           00850         movwf   txframe+5
                      00851 
                      00852         ;; Data
0238   300D           00853         movlw   0x0D
0239   00C4           00854         movwf   txframe+6
                      00855 
                      00856         ;; 0x00 Basic config response
023A   086E           00857         movf    w_loop_i, W
023B   3E01           00858         addlw   1
023C   2???           00859         call    read_eeprom
023D   00C5           00860         movwf   txframe+7
                      00861 
                      00862         ;; 0x00 Basic config response
023E   086E           00863         movf    w_loop_i, W
023F   3E02           00864         addlw   2
0240   2???           00865         call    read_eeprom
0241   00C6           00866         movwf   txframe+8
MPASM  5.50  /HOME/MOONSHINE/SPEEDBUS/PIC/MPL   3-24-2014  15:36:40         PAGE 42


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00867 
                      00868         ;; Data - DeviceID
0242   086E           00869         movf    w_loop_i, W
0243   3E03           00870         addlw   3
0244   2???           00871         call    read_eeprom
0245   00C7           00872         movwf   txframe+9
                      00873 
                      00874         ;; Data - DeviceID
0246   086E           00875         movf    w_loop_i, W
0247   3E04           00876         addlw   4
0248   2???           00877         call    read_eeprom
0249   00C8           00878         movwf   txframe+10
                      00879 
                      00880         ;; Padding bit
024A   3000           00881         movlw   0x00
024B   00C9           00882         movwf   txframe+11
                      00883 
024C                  00884 list_rfids_handle_response:
024C   1283 1303      00885         banksel rc_listen
024E   11AD           00886         bcf     rc_listen,3
                      00887 
024F   300A           00888         movlw   10
0250   1283 1303      00889         banksel w_hresp_loop
0252   00F0           00890         movwf   w_hresp_loop
                      00891 
                      00892 
0253                  00893 list_rfids_handle_response_loop:
0253   1283 1303      00894         banksel INTCON
0255   138B           00895         bcf     INTCON, GIE
0256   2???           00896         call    txdo
0257   1283 1303      00897         banksel INTCON
0259   178B           00898         bsf     INTCON, GIE
025A   1283 1303      00899         banksel rc_listen
025C   10AD           00900         bcf     rc_listen, 1
025D   12AD           00901         bcf     rc_listen, 5
                      00902 
                      00903         ;; If error
025E   1283 1303      00904         banksel RCSTA
0260   1898           00905         btfsc   RCSTA,OERR
0261   2???           00906         call    recerror
                      00907         ;;
                      00908 
0262   301E           00909         movlw   30
0263   2???           00910         call    dDelay
                      00911 
0264   1283 1303      00912         banksel rc_listen
0266   19AD           00913         btfsc   rc_listen,3
0267   2???           00914         goto    list_rfids_loop_e
0268   0BF0           00915         decfsz  w_hresp_loop,f
0269   2???           00916         goto    list_rfids_handle_response_loop
                      00917 
026A                  00918 list_rfids_loop_e:
026A   11AD           00919         bcf     rc_listen,3
MPASM  5.50  /HOME/MOONSHINE/SPEEDBUS/PIC/MPL   3-24-2014  15:36:40         PAGE 43


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00920 
026B   3005           00921         movlw   5
Message[305]: Using default destination of 1 (file).
026C   07EE           00922         addwf   w_loop_i
                      00923 
026D   0F6E           00924         incfsz  w_loop_i, w
026E   2???           00925         goto    list_rfids_loop
                      00926 
026F   1283 1303      00927         banksel main_commands
0271   10ED           00928         bcf     main_commands, 1
0272   2???           00929         goto    main
                      00930 
                      00931 ; Untill further investigation, this functions need to be implemented explictly to
                      00932 ; each processor
                      00933 
0273                  00934 read_eeprom:
0273   1703           00935         bsf     STATUS, RP1
                      00936         ;; Take the preset W number, and take the byte from the addr
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0274   008D           00937         movwf   EEADR
0275   1683           00938         bsf     STATUS, RP0
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0276   138C           00939         bcf     EECON1, EEPGD
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0277   140C           00940         bsf     EECON1, RD
0278   1283           00941         bcf     STATUS, RP0
                      00942         ;; Put the result in W
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0279   080C           00943         movf    EEDAT, W
027A   1303           00944         bcf     STATUS, RP1
027B   0008           00945         return
                      00946 
027C                  00947 write_eeprom:
027C   1703           00948         bsf     STATUS, RP1
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
027D   008C           00949         movwf   EEDAT ; write the value already in W to EEDAT, the data
027E   1303           00950         bcf     STATUS, RP1 ; Need this to get rc_nocoll
027F   082F           00951         movf    rc_nocoll,W
0280   1703           00952         bsf     STATUS, RP1 ;; ^^^^^^^^^^^
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0281   008D           00953         movwf   EEADR
0282   1683           00954         bsf     STATUS, RP0
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0283   138C           00955         bcf     EECON1, EEPGD
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0284   150C           00956         bsf     EECON1, WREN
                      00957 
                      00958         ; bcf   INTCON, GIE ; Well, GIE should be zero when it gets here
0285   3055           00959         movlw   0x55
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0286   008D           00960         movwf   EECON2
0287   30AA           00961         movlw   0xAA
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
MPASM  5.50  /HOME/MOONSHINE/SPEEDBUS/PIC/MPL   3-24-2014  15:36:40         PAGE 44


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0288   008D           00962         movwf   EECON2
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0289   148C           00963         bsf     EECON1, WR
                      00964         ; bsf     INTCON, GIE
                      00965 
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
028A   188C           00966         btfsc   EECON1, WR
028B   2???           00967         goto    $-1
                      00968 
                      00969 
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
028C   110C           00970         bcf     EECON1, WREN
028D   1283           00971         bcf     STATUS, RP0
028E   1303           00972         bcf     STATUS, RP1
028F   0008           00973         return
                      00974 
                      00975 
0290                  00976 Delay_01_ms:
                      00977                         ;199 cycles
0290   3042           00978         movlw   0x42
0291   00A0           00979         movwf   d1
0292                  00980 Delay_01_ms_0:
0292   0BA0           00981         decfsz  d1, f
0293   2???           00982         goto    Delay_01_ms_0
0294   0008           00983         return
                      00984 
0295                  00985 dDelay:
0295   1283 1303      00986     banksel dd1
                      00987         ;; 499994 cycles
0297   00F5           00988         movwf   dd3
0298   30FF           00989         movlw   0xFF
0299   00F4           00990         movwf   dd2
029A   3032           00991         movlw   50
029B   00F3           00992         movwf   dd1
029C                  00993 dDelay_0:
029C   0BF3           00994         decfsz  dd1, f
029D   2???           00995         goto    dDelay_0
029E   3014           00996         movlw   20                  ;; Need this for tuning
029F   00F3           00997         movwf   dd1
02A0   0BF4           00998         decfsz  dd2, f
02A1   2???           00999         goto    dDelay_0
02A2   3064           01000         movlw   100
02A3   00F4           01001         movwf   dd2
02A4   0BF5           01002         decfsz  dd3, f
02A5   2???           01003         goto    dDelay_0
02A6   0008           01004         return
                      01005 
30D4                  01006     end
MPASM  5.50  /HOME/MOONSHINE/SPEEDBUS/PIC/MPL   3-24-2014  15:36:40         PAGE 45


SYMBOL TABLE
  LABEL                             VALUE 

ABDEN                             00000000
ABDOVF                            00000007
ADCON0                            0000001F
ADCON1                            0000009F
ADCS0                             00000004
ADCS1                             00000005
ADCS2                             00000006
ADDEN                             00000003
ADFM                              00000007
ADIE                              00000006
ADIF                              00000006
ADON                              00000000
ADRESH                            0000001E
ADRESL                            0000009E
ANS0                              00000000
ANS1                              00000001
ANS10                             00000002
ANS11                             00000003
ANS2                              00000002
ANS3                              00000003
ANS4                              00000004
ANS5                              00000005
ANS6                              00000006
ANS7                              00000007
ANS8                              00000000
ANS9                              00000001
ANSEL                             0000011E
ANSELH                            0000011F
ARC_16F                           1
BAUDCTL                           0000009B
BF                                00000000
BRG0                              00000000
BRG1                              00000001
BRG10                             00000002
BRG11                             00000003
BRG12                             00000004
BRG13                             00000005
BRG14                             00000006
BRG15                             00000007
BRG16                             00000003
BRG2                              00000002
BRG3                              00000003
BRG4                              00000004
BRG5                              00000005
BRG6                              00000006
BRG7                              00000007
BRG8                              00000000
BRG9                              00000001
BRGH                              00000002
C                                 00000000
C1CH0                             00000000
C1CH1                             00000001
C1IE                              00000005
MPASM  5.50  /HOME/MOONSHINE/SPEEDBUS/PIC/MPL   3-24-2014  15:36:40         PAGE 46


SYMBOL TABLE
  LABEL                             VALUE 

C1IF                              00000005
C1OE                              00000005
C1ON                              00000007
C1OUT                             00000006
C1POL                             00000004
C1R                               00000002
C1SEN                             00000005
C1VREN                            00000007
C2CH0                             00000000
C2CH1                             00000001
C2IE                              00000006
C2IF                              00000006
C2OE                              00000005
C2ON                              00000007
C2OUT                             00000006
C2POL                             00000004
C2R                               00000002
C2REN                             00000004
C2SYNC                            00000000
C2VREN                            00000006
CCP1CON                           00000017
CCP1IE                            00000002
CCP1IF                            00000002
CCP1M0                            00000000
CCP1M1                            00000001
CCP1M2                            00000002
CCP1M3                            00000003
CCPR                              00000015
CCPR1H                            00000016
CCPR1L                            00000015
CHS0                              00000002
CHS1                              00000003
CHS2                              00000004
CHS3                              00000005
CKE                               00000006
CKP                               00000004
CM1CON0                           00000119
CM2CON0                           0000011A
CM2CON1                           0000011B
CREN                              00000004
CSRC                              00000007
D                                 00000005
DATA_ADDRESS                      00000005
DC                                00000001
DC1B0                             00000004
DC1B1                             00000005
DEV_ID1                           64
DEV_ID2                           50
D_A                               00000005
D_NOT_A                           00000005
Delay                             00000393
Delay_0                           0000039A
Delay_01_ms                       00000290
MPASM  5.50  /HOME/MOONSHINE/SPEEDBUS/PIC/MPL   3-24-2014  15:36:40         PAGE 47


SYMBOL TABLE
  LABEL                             VALUE 

Delay_01_ms_0                     00000292
ECCPAS                            0000001D
ECCPAS0                           00000004
ECCPAS1                           00000005
ECCPAS2                           00000006
ECCPASE                           00000007
EEADR                             0000010D
EEADRH                            0000010F
EECON1                            0000018C
EECON2                            0000018D
EEDAT                             0000010C
EEDATA                            0000010C
EEDATH                            0000010E
EEIE                              00000004
EEIF                              00000004
EEPGD                             00000007
F                                 00000001
FERR                              00000002
FSR                               00000004
GIE                               00000007
GO                                00000001
GO_DONE                           00000001
GO_NOT_DONE                       00000001
HTS                               00000002
I2C_DATA                          00000005
I2C_READ                          00000002
I2C_START                         00000003
I2C_STOP                          00000004
INDF                              00000000
INTCON                            0000000B
INTE                              00000004
INTEDG                            00000006
INTF                              00000001
IOC                               00000096
IOC0                              00000000
IOC1                              00000001
IOC2                              00000002
IOC3                              00000003
IOC4                              00000004
IOC5                              00000005
IOCA                              00000096
IOCA0                             00000000
IOCA1                             00000001
IOCA2                             00000002
IOCA3                             00000003
IOCA4                             00000004
IOCA5                             00000005
IOCB                              00000116
IOCB4                             00000004
IOCB5                             00000005
IOCB6                             00000006
IOCB7                             00000007
IRCF0                             00000004
MPASM  5.50  /HOME/MOONSHINE/SPEEDBUS/PIC/MPL   3-24-2014  15:36:40         PAGE 48


SYMBOL TABLE
  LABEL                             VALUE 

IRCF1                             00000005
IRCF2                             00000006
IRP                               00000007
Init                              0000000A
LTS                               00000001
MC1OUT                            00000007
MC2OUT                            00000006
MSK                               00000093
MSK0                              00000000
MSK1                              00000001
MSK2                              00000002
MSK3                              00000003
MSK4                              00000004
MSK5                              00000005
MSK6                              00000006
MSK7                              00000007
NOT_A                             00000005
NOT_ADDRESS                       00000005
NOT_BOR                           00000000
NOT_DONE                          00000001
NOT_PD                            00000003
NOT_POR                           00000001
NOT_RABPU                         00000007
NOT_T1SYNC                        00000002
NOT_TO                            00000004
NOT_W                             00000002
NOT_WRITE                         00000002
OERR                              00000001
OPTION_REG                        00000081
OSCCON                            0000008F
OSCTUNE                           00000090
OSFIE                             00000007
OSFIF                             00000007
OSTS                              00000003
OUTNUM                            4
OUTREG                            PORTB
P                                 00000004
P1M0                              00000006
P1M1                              00000007
PCL                               00000002
PCLATH                            0000000A
PCON                              0000008E
PDC0                              00000000
PDC1                              00000001
PDC2                              00000002
PDC3                              00000003
PDC4                              00000004
PDC5                              00000005
PDC6                              00000006
PEIE                              00000006
PIE1                              0000008C
PIE2                              0000008D
PIR1                              0000000C
MPASM  5.50  /HOME/MOONSHINE/SPEEDBUS/PIC/MPL   3-24-2014  15:36:40         PAGE 49


SYMBOL TABLE
  LABEL                             VALUE 

PIR2                              0000000D
PORTA                             00000005
PORTB                             00000006
PORTC                             00000007
PR2                               00000092
PRSEN                             00000007
PS0                               00000000
PS1                               00000001
PS2                               00000002
PSA                               00000003
PSSAC0                            00000002
PSSAC1                            00000003
PSSBD0                            00000000
PSSBD1                            00000001
PSTRCON                           0000019D
PULSR                             00000002
PULSS                             00000003
PWM1CON                           0000001C
R                                 00000002
RA0                               00000000
RA1                               00000001
RA2                               00000002
RA3                               00000003
RA4                               00000004
RA5                               00000005
RABIE                             00000003
RABIF                             00000000
RB4                               00000004
RB5                               00000005
RB6                               00000006
RB7                               00000007
RC0                               00000000
RC1                               00000001
RC2                               00000002
RC3                               00000003
RC4                               00000004
RC5                               00000005
RC6                               00000006
RC7                               00000007
RCIDL                             00000006
RCIE                              00000005
RCIF                              00000005
RCREG                             0000001A
RCSTA                             00000018
RD                                00000000
READ_EEPROM                       read_eeprom
READ_WRITE                        00000002
REC_CUSTOM_JUMP                   custom_command_handler
RP0                               00000005
RP1                               00000006
RX9                               00000006
RX9D                              00000000
R_NOT_W                           00000002
MPASM  5.50  /HOME/MOONSHINE/SPEEDBUS/PIC/MPL   3-24-2014  15:36:40         PAGE 50


SYMBOL TABLE
  LABEL                             VALUE 

R_W                               00000002
S                                 00000003
SBOREN                            00000004
SCKP                              00000004
SCS                               00000000
SENB                              00000003
SENDB                             00000003
SMP                               00000007
SPBRG                             00000099
SPBRGH                            0000009A
SPEEDLIB_RESPONSE_DELAY           9
SPEN                              00000007
SR0                               00000006
SR1                               00000007
SRCON                             0000019E
SREN                              00000005
SSPADD                            00000093
SSPBUF                            00000013
SSPCON                            00000014
SSPEN                             00000005
SSPIE                             00000003
SSPIF                             00000003
SSPM0                             00000000
SSPM1                             00000001
SSPM2                             00000002
SSPM3                             00000003
SSPMSK                            00000093
SSPOV                             00000006
SSPSTAT                           00000094
STATUS                            00000003
STRA                              00000000
STRB                              00000001
STRC                              00000002
STRD                              00000003
STRSYNC                           00000004
SWDTEN                            00000000
SYNC                              00000004
Stable                            00000018
T0CS                              00000005
T0IE                              00000005
T0IF                              00000002
T0SE                              00000004
T1CKPS0                           00000004
T1CKPS1                           00000005
T1CON                             00000010
T1GINV                            00000007
T1GSS                             00000001
T1IE                              00000000
T1IF                              00000000
T1OSCEN                           00000003
T2CKPS0                           00000000
T2CKPS1                           00000001
T2CON                             00000012
MPASM  5.50  /HOME/MOONSHINE/SPEEDBUS/PIC/MPL   3-24-2014  15:36:40         PAGE 51


SYMBOL TABLE
  LABEL                             VALUE 

T2IE                              00000001
T2IF                              00000001
TMR0                              00000001
TMR1                              0000000E
TMR1CS                            00000001
TMR1GE                            00000006
TMR1H                             0000000F
TMR1IE                            00000000
TMR1IF                            00000000
TMR1L                             0000000E
TMR1ON                            00000000
TMR2                              00000011
TMR2IE                            00000001
TMR2IF                            00000001
TMR2ON                            00000002
TOUTPS0                           00000003
TOUTPS1                           00000004
TOUTPS2                           00000005
TOUTPS3                           00000006
TRISA                             00000085
TRISA0                            00000000
TRISA1                            00000001
TRISA2                            00000002
TRISA3                            00000003
TRISA4                            00000004
TRISA5                            00000005
TRISB                             00000086
TRISB4                            00000004
TRISB5                            00000005
TRISB6                            00000006
TRISB7                            00000007
TRISC                             00000087
TRISC0                            00000000
TRISC1                            00000001
TRISC2                            00000002
TRISC3                            00000003
TRISC4                            00000004
TRISC5                            00000005
TRISC6                            00000006
TRISC7                            00000007
TRMT                              00000001
TUN0                              00000000
TUN1                              00000001
TUN2                              00000002
TUN3                              00000003
TUN4                              00000004
TX9                               00000006
TX9D                              00000000
TXEN                              00000005
TXIE                              00000004
TXIF                              00000004
TXREG                             00000019
TXSTA                             00000098
MPASM  5.50  /HOME/MOONSHINE/SPEEDBUS/PIC/MPL   3-24-2014  15:36:40         PAGE 52


SYMBOL TABLE
  LABEL                             VALUE 

UA                                00000001
ULPWUE                            00000005
USER_VARIABLE_SPACE               0x67
VCFG                              00000006
VP6EN                             00000004
VR0                               00000000
VR1                               00000001
VR2                               00000002
VR3                               00000003
VRCON                             00000118
VRR                               00000005
W                                 00000000
WCOL                              00000007
WDTCON                            00000097
WDTPS0                            00000001
WDTPS1                            00000002
WDTPS2                            00000003
WDTPS3                            00000004
WPU                               00000095
WPU0                              00000000
WPU1                              00000001
WPU2                              00000002
WPU4                              00000004
WPU5                              00000005
WPUA                              00000095
WPUA0                             00000000
WPUA1                             00000001
WPUA2                             00000002
WPUA4                             00000004
WPUA5                             00000005
WPUB                              00000115
WPUB4                             00000004
WPUB5                             00000005
WPUB6                             00000006
WPUB7                             00000007
WR                                00000001
WREN                              00000002
WRERR                             00000003
WRITE_EEPROM                      write_eeprom
WUE                               00000001
Z                                 00000002
_.org_1_028B                      0000028B
_BOD_NSLEEP                       00003EFF
_BOD_OFF                          00003CFF
_BOD_ON                           00003FFF
_BOD_SBODEN                       00003DFF
_BOREN_NSLEEP                     00003EFF
_BOREN_OFF                        00003CFF
_BOREN_ON                         00003FFF
_BOREN_SBODEN                     00003DFF
_BOR_NSLEEP                       00003EFF
_BOR_OFF                          00003CFF
_BOR_ON                           00003FFF
MPASM  5.50  /HOME/MOONSHINE/SPEEDBUS/PIC/MPL   3-24-2014  15:36:40         PAGE 53


SYMBOL TABLE
  LABEL                             VALUE 

_BOR_SBODEN                       00003DFF
_CONFIG                           00002007
_CPD_OFF                          00003FFF
_CPD_ON                           00003F7F
_CP_OFF                           00003FFF
_CP_ON                            00003FBF
_DEVID1                           00002006
_EC_OSC                           00003FFB
_EXTRC                            00003FFF
_EXTRCIO                          00003FFE
_EXTRC_OSC_CLKOUT                 00003FFF
_EXTRC_OSC_NOCLKOUT               00003FFE
_FCMEN_OFF                        000037FF
_FCMEN_ON                         00003FFF
_FOSC_EC                          00003FFB
_FOSC_EXTRCCLK                    00003FFF
_FOSC_EXTRCIO                     00003FFE
_FOSC_HS                          00003FFA
_FOSC_INTRCCLK                    00003FFD
_FOSC_INTRCIO                     00003FFC
_FOSC_LP                          00003FF8
_FOSC_XT                          00003FF9
_HS_OSC                           00003FFA
_IDLOC0                           00002000
_IDLOC1                           00002001
_IDLOC2                           00002002
_IDLOC3                           00002003
_IESO_OFF                         00003BFF
_IESO_ON                          00003FFF
_INTOSC                           00003FFD
_INTOSCIO                         00003FFC
_INTRC_OSC_CLKOUT                 00003FFD
_INTRC_OSC_NOCLKOUT               00003FFC
_LP_OSC                           00003FF8
_MCLRE_OFF                        00003FDF
_MCLRE_ON                         00003FFF
_PWRTE_OFF                        00003FFF
_PWRTE_ON                         00003FEF
_WDTE_OFF                         00003FF7
_WDTE_ON                          00003FFF
_WDT_OFF                          00003FF7
_WDT_ON                           00003FFF
_XT_OSC                           00003FF9
__16F690                          00000001
add_new_rfid                      00000188
add_new_rfid_loop                 0000018C
add_new_rfid_loop_e               000001AA
add_new_rfid_loop_ee              000001D5
adress1                           00000033
adress2                           00000034
baud                              00004B00
brgdiv                            00000004
brgval                            00000067
MPASM  5.50  /HOME/MOONSHINE/SPEEDBUS/PIC/MPL   3-24-2014  15:36:40         PAGE 54


SYMBOL TABLE
  LABEL                             VALUE 

clock                             00000008
crc0                              00000037
crc1                              00000038
crccalc                           00000325
crcloop                           00000039
crcloopr                          00000320
crcsend                           0000035F
crctmp                            0000003A
custom_command_handler            00000172
d1                                00000020
d1_tmp                            00000027
d2                                00000021
d2_tmp                            00000028
d3                                00000022
d3_tmp                            00000029
d4                                00000023
dDelay                            00000295
dDelay_0                          0000029C
dd1                               00000073
dd2                               00000074
dd3                               00000075
endflag                           00000368
endflag_l                         0000036C
framelen                          0000003B
func_bc                           00000216
func_bc_01                        00000237
func_bc_sendaddr                  00000246
func_check_response               000001E1
func_is_ocupied_send_response     000001E5
func_is_ocupied_send_response_go  000001EC
func_is_ocupied_send_response_pa  000001EE
func_rand_addr                    00000282
func_send_iam_here                00000266
func_send_response                000001B9
func_set_rsp_addr                 00000297
func_setport                      0000028C
func_speedlib_config              00000135
func_speedlib_config_basics       0000018D
func_speedlib_config_caddr        0000014D
func_speedlib_config_caddr_f      00000168
func_speedlib_config_extended     0000013E
handle_response                   000002AC
handle_response_loop              000002B8
handle_response_ret               000002C5
init_speedlib                     00000000
intserv                           00000037
intserv_norm                      00000041
lfsr_func                         00000387
list_rfids                        00000221
list_rfids_dev                    00000214
list_rfids_handle_response        0000024C
list_rfids_handle_response_loop   00000253
list_rfids_loop                   00000223
MPASM  5.50  /HOME/MOONSHINE/SPEEDBUS/PIC/MPL   3-24-2014  15:36:40         PAGE 55


SYMBOL TABLE
  LABEL                             VALUE 

list_rfids_loop_e                 0000026A
loop1                             0000002B
loop2                             0000002C
lopp                              00000357
main                              0000004A
main_commands                     0000006D
pair                              00000067
pair_c                            00000068
rand                              0000002A
rc1                               00000054
rc10                              0000005D
rc11                              0000005E
rc12                              0000005F
rc13                              00000060
rc14                              00000061
rc15                              00000062
rc16                              00000063
rc17                              00000064
rc18                              00000065
rc19                              00000066
rc2                               00000055
rc20                              00000067
rc3                               00000056
rc4                               00000057
rc5                               00000058
rc6                               00000059
rc7                               0000005A
rc8                               0000005B
rc9                               0000005C
rc_add_byte                       00000030
rc_counter                        0000002E
rc_listen                         0000002D
rc_nocoll                         0000002F
rcframe                           00000053
read_eeprom                       00000273
read_wiegand                      0000005A
read_wiegand_delay                0000011C
read_wiegand_delay_loop           0000011E
read_wiegand_loop1                00000069
read_wiegand_pair_ceaven          0000012A
read_wiegand_pair_codd            0000014B
read_wiegand_pari_c1              0000016C
read_wiegand_pari_c2              0000016F
read_wiegand_return               000000F3
read_wiegand_seeprom_loop         000000C3
read_wiegand_seeprom_loop_e       000000EF
read_wiegand_wait                 000000F4
rec                               00000064
rec_oops_coll                     00000070
rec_start                         00000074
reccrcfail                        000002C8
reccrcfail_end                    000002D0
recend                            000000BC
MPASM  5.50  /HOME/MOONSHINE/SPEEDBUS/PIC/MPL   3-24-2014  15:36:40         PAGE 56


SYMBOL TABLE
  LABEL                             VALUE 

recend_no_broadcast               000000F5
recend_tmp                        000000F0
recerror                          000002D4
recsave                           00000086
recsave_add                       000000AA
recsave_set                       00000094
recsave_unescape                  00000098
recsave_unescape_1                000000A6
recsave_unescape_2                000000A8
recx                              0000007F
restore                           00000053
restore_norm                      00000057
rm_rfid                           000001DA
rm_rfid_loop                      000001DE
rm_rfid_loop_e                    0000020F
rsp_adress1                       00000031
rsp_adress2                       00000032
send                              00000352
send_rfidnr                       000000FD
set_get_tag                       00000183
speedlib_config                   00000035
speedlib_main                     00000036
tmp_PCLATH                        00000026
tmp_STATUS                        00000025
tmp_W                             00000024
trd                               00000377
tx1                               0000003F
tx10                              00000048
tx11                              00000049
tx12                              0000004A
tx13                              0000004B
tx14                              0000004C
tx15                              0000004D
tx16                              0000004E
tx17                              0000004F
tx18                              00000050
tx19                              00000051
tx2                               00000040
tx20                              00000052
tx3                               00000041
tx4                               00000042
tx5                               00000043
tx6                               00000044
tx7                               00000045
tx8                               00000046
tx9                               00000047
tx_send                           000002E3
tx_send_escape_1                  00000307
tx_send_escape_2                  0000030C
tx_send_noescape                  000002EF
tx_send_noescape_k                00000304
tx_send_noescape_l                000002FE
txdo                              00000311
MPASM  5.50  /HOME/MOONSHINE/SPEEDBUS/PIC/MPL   3-24-2014  15:36:40         PAGE 57


SYMBOL TABLE
  LABEL                             VALUE 

txdo2                             00000340
txframe                           0000003E
txoops                            000002D9
txreturn                          0000003D
txtmp                             0000003C
v_reset                           00000005
w1                                00000069
w2                                0000006A
w3                                0000006B
w4                                0000006C
w_hresp_addr1                     00000071
w_hresp_addr2                     00000072
w_hresp_loop                      00000070
w_loop_i                          0000006E
w_tmp                             0000006F
write_eeprom                      0000027C

Errors   :     0
Warnings :     4 reported,     0 suppressed
Messages :    32 reported,     0 suppressed

