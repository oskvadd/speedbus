MPASM  5.42  /HOME/OSCAR/SPEEDBUS/PIC/MPLABX.   7-23-2012  18:09:24         PAGE  1


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00001 ;#include "/usr/share/gputils/header/p16f690.inc"
                      00002 ;            errorlevel -302
                      00003 
                      00004 ;
                      00005 ;   #define     REC_CUSTOM_JUMP         custom_command_handler ; This is the name of the command to use,
                             if it is a custom command. like, "jump to this statment if it is a custom command"
                      00006 ;   #define     CUSTOM_INTERRUPT        c_intserv              ; NOTE: When use this define, remember th
                            at the jumpback, to the ordinary interupthandler, need to be "ci_restore", if the interupt does 
                      00007 ;
                      00008 ;
                      00009 ; Using two device id:s, maybe not predefined, so...
                      00010 ; The definition of thease bytes should not be done in the lib file, but in the main asm file, so difren
                            t deviceid:s on difrent sources can be used.
                      00011 
                      00012 #ifndef DEV_ID1
                      00013 #define DEV_ID1 0
                      00014 #endif
                      00015 #ifndef DEV_ID2
                      00016 #define DEV_ID2 0
                      00017 #endif
                      00018 
                      00019         radix dec
                      00020 
                      00021 #define     USER_VARIABLE_SPACE         0x49    ; 0x66 but added two, just in case
                      00022         cblock  0x20
  00000020            00023              d1                 ; Define three file registers for the
  00000021            00024              d2                 ; delay loop
  00000022            00025              d3
  00000023            00026              d4
  00000024            00027              tmp_W
  00000025            00028              tmp_STATUS
  00000026            00029              tmp_PCLATH
  00000027            00030              d1_tmp
  00000028            00031              d2_tmp
  00000029            00032              d3_tmp
  0000002A            00033              rand
  0000002B            00034              loop1              ; Loop mem 1
  0000002C            00035              loop2              ; Loop mem 2
  0000002D            00036              rc_listen          ; |X-------|b7 = NoNE
                      00037                                 ; |-X------|b6 = NoNE
                      00038                                 ; |--X-----|b5 = NoNE
                      00039                                 ; |---X----|b4 = NoNE
                      00040                                 ; |----X---|b3 = This bit got set if the device recive a usual response 
                            package (0x00)
                      00041                                 ; |-----X--|b2 = This is an internal function for the recsave rutine, so
                             the cewd know that following byte is escaped.
                      00042                                 ; |------X-|b1 = If you set this bit to 1 the cewd will handle the byte 
                            as loopback, and if it dosent match the byte in rc_nocoll
                      00043                                 ; |-------X|b0 = This bit got set if the device recive an answer to a "c
                            heck_addr" package, to confirm that the adress is ocupied
  0000002E            00044              rc_counter         ; RC framelen
  0000002F            00045              rc_gotflag         ; Set to 1 if it "got a flag"
  00000030            00046              rc_nocoll          ; Use this to confim that no collission has ocurred
MPASM  5.42  /HOME/OSCAR/SPEEDBUS/PIC/MPLABX.   7-23-2012  18:09:24         PAGE  2


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

  00000031            00047              rc_add_byte        ; recsave_add temporary argument
  00000032            00048              rsp_adress1        ; The response adress at the bus
  00000033            00049              rsp_adress2        ; The response adress at the bus
  00000034            00050              adress1            ; The adress at the bus
  00000035            00051              adress2            ; The adress at the bus
  00000036            00052              speedlib_config    ; |X-------|b7 = NoNE
                      00053                                 ; |-X------|b6 = NoNE
                      00054                                 ; |--X-----|b5 = NoNE
                      00055                                 ; |---X----|b4 = NoNE
                      00056                                 ; |----X---|b3 = NoNe
                      00057                                 ; |-----X--|b2 = NoNe
                      00058                                 ; |------X-|b1 = Set this bit 1 if adress is stamped.
                      00059                                 ; |-------X|b0 = On, Off this bit, if you want to make the device check 
                            the adress on startup.
  00000037            00060              speedlib_main      ; |X-------|b7 = NoNE
                      00061                                 ; |-X------|b6 = NoNE
                      00062                                 ; |--X-----|b5 = NoNE
                      00063                                 ; |---X----|b4 = NoNE
                      00064                                 ; |----X---|b3 = NoNe
                      00065                                 ; |-----X--|b2 = If this bit got set, the cewd will send a response pack
                            age when returning to restore
                      00066                                 ; |------X-|b1 = This bit should be set, if the device has sent an packa
                            ge, that should be responde to
                      00067                                 ; |-------X|b0 = This bit, is SET when an interupt has occured. If you s
                            et this to zero before youre rutine, and check the bit after, you will se if an interupt has ocu
  00000038            00068              crc0
  00000039            00069              crc1
  0000003A            00070              crcloop
  0000003B            00071              crctmp
  0000003C            00072              framelen           ; TX framelen
  0000003D            00073              txtmp              ; temporary before sending
  0000003E            00074              txreturn           ; Hardcoded return, if nessesary(in interupts)
  0000003F            00075              txframe, tx1, tx2, tx3, tx4, tx5, tx6, tx7, tx8, tx9, tx10 ; Current package limit, 20B
  0000004A            00076              tx11, tx12, tx13, tx14, tx15, tx16, tx17, tx18, tx19, tx20
  00000054            00077              rcframe, rc1, rc2, rc3, rc4, rc5, rc6, rc7, rc8, rc9, rc10 ; Current package limit, 20B
  0000005F            00078              rc11, rc12, rc13, rc14, rc15, rc16, rc17, rc18, rc19, rc20
                      00079         endc
                      00080         ;; EEPROM
                      00081         ;; 0x00 ; addr1
                      00082         ;; 0x01 ; addr2
                      00083         ;; 0x02 ; Speedbus configuration register
                      00084 
                      00085 .code_page0_ CODE
                      00086 
0000                  00087 init_speedlib:
                      00088     ;; Preset some values
0000   1137           00089     bcf     speedlib_main,2
0001   10B7           00090     bcf     speedlib_main,1
Error[113]  : Symbol not previously defined (PORTB)
0002   1200           00091     bcf     PORTB,4
0003   10AD           00092     bcf     rc_listen,1
                      00093 
                      00094 
MPASM  5.42  /HOME/OSCAR/SPEEDBUS/PIC/MPLABX.   7-23-2012  18:09:24         PAGE  3


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00095     ;; Take adress from eeprom, if it is set.
0004   3000           00096     movlw   0
0005   2???           00097     call    read_eeprom
0006   00B4           00098     movwf   adress1
0007   3001           00099     movlw   1
0008   2???           00100     call    read_eeprom
0009   00B5           00101     movwf   adress2
000A   3002           00102     movlw   2
000B   2???           00103     call    read_eeprom
000C   00B6           00104     movwf   speedlib_config
000D   1836           00105     btfsc   speedlib_config,0
000E   2???           00106     call    init_checkaddr
                      00107 
                      00108     ; If adress is 0xFFFF, force init_checkaddr
000F   30FF           00109     movlw       0xFF            
0010   0234           00110     subwf       adress1,W
Error[113]  : Symbol not previously defined (STATUS)
Error[113]  : Symbol not previously defined (Z)
0011   1C00           00111     btfss       STATUS,Z
0012   2???           00112     goto        init_speedlib_e
0013   30FF           00113     movlw       0xFF
0014   0235           00114     subwf       adress2,W
Error[113]  : Symbol not previously defined (STATUS)
Error[113]  : Symbol not previously defined (Z)
0015   1C00           00115     btfss       STATUS,Z
0016   2???           00116     goto        init_speedlib_e
0017   01B4           00117     clrf        adress1
0018   01B5           00118     clrf        adress2
0019   2???           00119     call        init_checkaddr
                      00120 
001A                  00121 init_speedlib_e:
                      00122 
001A   0008           00123     return
                      00124 
001B                  00125 init_checkaddr:
001B   3003           00126         movlw   3
001C   00AB           00127         movwf   loop1
                      00128         
001D                  00129 init_checkaddr_l:
                      00130         ;; Send porta over TX
001D   3009           00131         movlw   9
001E   00BC           00132         movwf   framelen
                      00133         ;; * adress
001F   0834           00134         movf    adress1,W
0020   00BF           00135         movwf   txframe 
                      00136         ;; * adress
0021   0835           00137         movf    adress2,W
0022   00C0           00138         movwf   txframe+1
                      00139         ;; 0xff broadcast adress
0023   30FF           00140         movlw   0xff
0024   00C1           00141         movwf   txframe+2
                      00142         ;; 0xff broadcast adress
0025   30FF           00143         movlw   0xff
MPASM  5.42  /HOME/OSCAR/SPEEDBUS/PIC/MPLABX.   7-23-2012  18:09:24         PAGE  4


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0026   00C2           00144         movwf   txframe+3
                      00145         ;; 0x03 control bit
0027   3003           00146         movlw   0x03
0028   00C3           00147         movwf   txframe+4
                      00148         ;; 0x01 protocoll
0029   3000           00149         movlw   0x00
002A   00C4           00150         movwf   txframe+5
                      00151         ;; Data
002B   3001           00152         movlw   0x01
002C   00C5           00153         movwf   txframe+6
                      00154         ;; Padding bit
002D   3000           00155         movlw   0x00
002E   00C6           00156         movwf   txframe+7
                      00157 
                      00158 
002F   2???           00159         call    txdo
                      00160 
                      00161         
0030   142D           00162         bsf     rc_listen,0
0031   300A           00163         movlw   10
0032   2???           00164         call    Delay
0033   182D           00165         btfsc   rc_listen,0
0034   2???           00166         goto    init_checkaddr_not_ocupied
0035   2???           00167         goto    init_checkaddr_ocupied
                      00168 
0036                  00169 init_checkaddr_not_ocupied:
0036   0BAB           00170         decfsz  loop1, f
0037   2???           00171         goto    init_checkaddr_l
0038   102D           00172         bcf     rc_listen,0     
0039   0008           00173         return
                      00174 
                      00175         
003A                  00176 init_checkaddr_ocupied:
003A   2???           00177         call    setaddr
003B   0008           00178         return
                      00179 
003C                  00180 setaddr:
003C   3000           00181         movlw   0x00
003D   00B4           00182         movwf   adress1
003E   3000           00183         movlw   0x00
003F   00B5           00184         movwf   adress2
                      00185 
0040                  00186 setaddr1:       
                      00187         
0040   0FB5           00188         incfsz  adress2, f
0041   2???           00189         goto    setaddr2
                      00190 
0042   3000           00191         movlw   0x00
0043   00AC           00192         movwf   loop2
                      00193 
0044   0FB4           00194         incfsz  adress1, f
0045   2???           00195         goto    setaddr2
0046   0008           00196         return                  ; ALERT!!! Change this to a rutin that show an error that no adress is a
MPASM  5.42  /HOME/OSCAR/SPEEDBUS/PIC/MPLABX.   7-23-2012  18:09:24         PAGE  5


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                            vailible (all ~65535 is taken)
                      00197 
0047                  00198 setaddr2:
                      00199         ;; Send porta over TX
0047   3009           00200         movlw   9
0048   00BC           00201         movwf   framelen
                      00202         ;; * adress
0049   0834           00203         movf    adress1,W
004A   00BF           00204         movwf   txframe 
                      00205         ;; * adress
004B   0835           00206         movf    adress2,W
004C   00C0           00207         movwf   txframe+1
                      00208         ;; 0xff broadcast adress
004D   30FF           00209         movlw   0xff
004E   00C1           00210         movwf   txframe+2
                      00211         ;; 0xff broadcast adress
004F   30FF           00212         movlw   0xff
0050   00C2           00213         movwf   txframe+3
                      00214         ;; 0x03 control bit
0051   3003           00215         movlw   0x03
0052   00C3           00216         movwf   txframe+4
                      00217         ;; 0x01 protocoll
0053   3000           00218         movlw   0x00
0054   00C4           00219         movwf   txframe+5
                      00220         ;; Data
0055   3001           00221         movlw   0x01
0056   00C5           00222         movwf   txframe+6
                      00223         ;; Padding bit
0057   3000           00224         movlw   0x00
0058   00C6           00225         movwf   txframe+7
                      00226 
                      00227 
0059   2???           00228         call    txdo
                      00229 
005A   142D           00230         bsf     rc_listen,0
005B   3001           00231         movlw   1
005C   2???           00232         call    Delay
005D   182D           00233         btfsc   rc_listen,0
005E   2???           00234         goto    setaddr_testloop
005F   2???           00235         goto    setaddr1
                      00236 
                      00237         
0060                  00238 setaddr_testloop:               ; Send this rutine another 2 times, to make sure that the previus packet
                             not was droped
0060   3002           00239         movlw   2
0061   00AB           00240         movwf   loop1
0062                  00241 setaddr_testloop_l:     
                      00242 
0062   2???           00243         call    txdo
                      00244 
0063   142D           00245         bsf     rc_listen,0
0064   3001           00246         movlw   1
0065   2???           00247         call    Delay
MPASM  5.42  /HOME/OSCAR/SPEEDBUS/PIC/MPLABX.   7-23-2012  18:09:24         PAGE  6


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0066   1C2D           00248         btfss   rc_listen,0
0067   2???           00249         goto    setaddr1
0068   0BAB           00250         decfsz  loop1,  f
0069   2???           00251         goto    setaddr_testloop_l
006A   0008           00252         return                  ; The adress sems nice! Returning, and keep the composed adress!
                      00253         
                      00254         
                      00255         
006B                  00256 intserv:
                      00257 
                      00258 
006B   1437           00259         bsf     speedlib_main,0 ;       Set this bit to one, when an interupt ocurres
                      00260 
                      00261 
006C   1CB7           00262         btfss   speedlib_main,1         ;; Waiting for response STATE? Jump direct to recend_no_broadcas
                            t
006D   2???           00263         goto    intserv_norm
Error[113]  : Symbol not previously defined (PIR1)
Error[113]  : Symbol not previously defined (RCIF)
006E   1800           00264         btfsc   PIR1,RCIF       ;       Check if the recived data bit is set
006F   2???           00265         goto    rec             ;       Jump to recive data rutine if the PIR1 bit is 1
0070   2???           00266         goto    restore
                      00267 
0071                  00268 intserv_norm:
0071   00A4           00269         movwf   tmp_W           ;       Register BKP before the interup code exec
Error[113]  : Symbol not previously defined (STATUS)
0072   0800           00270         movf    STATUS,W
Error[113]  : Symbol not previously defined (STATUS)
0073   0180           00271         clrf    STATUS
0074   00A5           00272         movwf   tmp_STATUS
Error[113]  : Symbol not previously defined (PCLATH)
0075   0800           00273         movf    PCLATH,W
0076   00A6           00274         movwf   tmp_PCLATH
0077   0820           00275         movf    d1,W
0078   00A7           00276         movwf   d1_tmp
0079   0821           00277         movf    d2,W
007A   00A8           00278         movwf   d2_tmp
007B   0822           00279         movf    d3,W
007C   00A9           00280         movwf   d3_tmp
                      00281         #ifdef  CUSTOM_INTERRUPT
                      00282         goto    CUSTOM_INTERRUPT
                      00283 ci_restore:
                      00284         #endif
                      00285 
                      00286 
Error[113]  : Symbol not previously defined (PIR1)
Error[113]  : Symbol not previously defined (RCIF)
007D   1800           00287         btfsc   PIR1,RCIF       ;       Check if the recived data bit is set
007E   2???           00288         goto    rec             ;       Jump to recive data rutine if the PIR1 bit is 1
                      00289 
                      00290 
007F                  00291 restore:
                      00292                         ;       Restore the regisers
MPASM  5.42  /HOME/OSCAR/SPEEDBUS/PIC/MPLABX.   7-23-2012  18:09:24         PAGE  7


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

007F   18B7           00293         btfsc   speedlib_main,1         ;; Waiting for response STATE? Dont
0080   0009           00294         retfie                          ;; restore saved, nothing is saved
                      00295 
                      00296         ;; If:  Send back a response package, to confirm that the package has been recived
                      00297 ;        btfss   speedlib_main,2
                      00298 ;        goto    restore_norm
                      00299 ;        bcf     speedlib_main,2
                      00300 ;        call    func_send_response
                      00301         ;;
                      00302 
0081                  00303 restore_norm:
                      00304 
                      00305 
0081   0827           00306         movf    d1_tmp,W
0082   00A0           00307         movwf   d1
0083   0828           00308         movf    d2_tmp,W
0084   00A1           00309         movwf   d2
0085   0829           00310         movf    d3_tmp,W
0086   00A2           00311         movwf   d3      
0087   0826           00312         movf    tmp_PCLATH,W
Error[113]  : Symbol not previously defined (PCLATH)
0088   0080           00313         movwf   PCLATH
0089   0825           00314         movf    tmp_STATUS,W
Error[113]  : Symbol not previously defined (STATUS)
008A   0080           00315         movwf   STATUS
008B   0EA4           00316         swapf   tmp_W,F
008C   0E24           00317         swapf   tmp_W,W
008D   0009           00318         retfie
                      00319         
                      00320 
008E                  00321 rec:
                      00322 
008E   1CAD           00323         btfss   rc_listen,1             ; If rc_listen is set to NOT drop the loopback package, jump dir
                            ectly to the rec_start
008F   2???           00324         goto    rec_start               
                      00325 
0090   10AD           00326         bcf     rc_listen,1             ;; Start this rutine with checking that the recived bit NOT was 
                            send from this own device
0091   0830           00327         movf    rc_nocoll,W
Error[113]  : Symbol not previously defined (RCREG)
0092   0200           00328         subwf   RCREG,W
Error[113]  : Symbol not previously defined (STATUS)
Error[113]  : Symbol not previously defined (Z)
0093   1C00           00329         btfss   STATUS,Z
0094   2???           00330         goto    rec_oops_coll           ; Anyway, if the rc_listen,1  is 1, and it do not match RCREG, w
                            e may be detected an collission
0095   2???           00331         goto    restore
0096                  00332 rec_oops_coll:
Error[113]  : Symbol not previously defined (PORTC)
0096   1400           00333         bsf     PORTC,0
0097   14BE           00334         bsf     txreturn,1
0098   2???           00335         goto    restore
                      00336         
MPASM  5.42  /HOME/OSCAR/SPEEDBUS/PIC/MPLABX.   7-23-2012  18:09:24         PAGE  8


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0099                  00337 rec_start:
0099   307E           00338         movlw   0x7e
Error[113]  : Symbol not previously defined (RCREG)
009A   0200           00339         subwf   RCREG,W
Error[113]  : Symbol not previously defined (STATUS)
Error[113]  : Symbol not previously defined (Z)
009B   1800           00340         btfsc   STATUS,Z
009C   2???           00341         goto    recx            ; Jump if this is a flag bit
009D   182F           00342         btfsc   rc_gotflag,0
009E   2???           00343         goto    recsave         ; Jump if the flag bit is set
009F   2???           00344         goto    recr
00A0                  00345 recx:   
00A0   182F           00346         btfsc   rc_gotflag,0
00A1   2???           00347         goto    recend          ; If this may be end flag, check the package, finalize, check crc
00A2   142F           00348         bsf     rc_gotflag,0    ; Else set the gotflag, and start recording package!
00A3   01AE           00349         clrf    rc_counter      ; Clear the counter :)
00A4   2???           00350         goto    restore
00A5                  00351 recr:   
                      00352         ;       movf    RCREG,W
                      00353         ;       movwf   TXREG           
00A5   2???           00354         goto    restore
                      00355 
00A6                  00356 recsave:
00A6   307D           00357         movlw   0x7d
Error[113]  : Symbol not previously defined (RCREG)
00A7   0200           00358         subwf   RCREG,W
Error[113]  : Symbol not previously defined (STATUS)
Error[113]  : Symbol not previously defined (Z)
00A8   1800           00359         btfsc   STATUS,Z
00A9   2???           00360         goto    recsave_set     ; Set bit in the rc_listen to aktivate escape routines when the next byt
                            e is recived
00AA   192D           00361         btfsc   rc_listen,2
00AB   2???           00362         goto    recsave_unescape
                      00363 
Error[113]  : Symbol not previously defined (RCREG)
00AC   0800           00364         movf    RCREG,W
00AD   2???           00365         goto    recsave_add
                      00366 
00AE                  00367 recsave_set:
00AE   152D           00368         bsf     rc_listen,2
00AF   2???           00369         goto    restore
                      00370 
00B0                  00371 recsave_unescape:
00B0   112D           00372         bcf     rc_listen,2
00B1   305E           00373         movlw   0x5e
Error[113]  : Symbol not previously defined (RCREG)
00B2   0200           00374         subwf   RCREG,W
Error[113]  : Symbol not previously defined (STATUS)
Error[113]  : Symbol not previously defined (Z)
00B3   1800           00375         btfsc   STATUS,Z
00B4   2???           00376         goto    recsave_unescape_1
00B5   305D           00377         movlw   0x5d
Error[113]  : Symbol not previously defined (RCREG)
MPASM  5.42  /HOME/OSCAR/SPEEDBUS/PIC/MPLABX.   7-23-2012  18:09:24         PAGE  9


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

00B6   0200           00378         subwf   RCREG,W
Error[113]  : Symbol not previously defined (STATUS)
Error[113]  : Symbol not previously defined (Z)
00B7   1800           00379         btfsc   STATUS,Z
00B8   2???           00380         goto    recsave_unescape_2
00B9   2???           00381         goto    restore         ; Maybe you can change this, but a fail package that is the result, will
                             also be CRC checked
                      00382         
00BA                  00383 recsave_unescape_1:
00BA   307E           00384         movlw   0x7e
00BB   2???           00385         goto    recsave_add
00BC                  00386 recsave_unescape_2:
00BC   307D           00387         movlw   0x7d
00BD   2???           00388         goto    recsave_add
                      00389         
00BE                  00390 recsave_add:
00BE   00B1           00391         movwf   rc_add_byte
00BF   3054           00392         movlw   rcframe         ; Place where to put the receiving byte
00C0   072E           00393         addwf   rc_counter,W    ; Add the number in rc_flow, to the pointer, like rcframe[rc_flow] 
Error[113]  : Symbol not previously defined (FSR)
00C1   0080           00394         movwf   FSR
00C2   0831           00395         movf    rc_add_byte,W
Error[113]  : Symbol not previously defined (INDF)
00C3   0080           00396         movwf   INDF
00C4   0A2E           00397         incf    rc_counter,W
00C5   00AE           00398         movwf   rc_counter
00C6   2???           00399         goto    restore
                      00400         
00C7                  00401 recend:
00C7   032E           00402         decf    rc_counter,W
00C8   00AE           00403         movwf   rc_counter
00C9   00BA           00404         movwf   crcloop
00CA   3054           00405         movlw   rcframe
Error[113]  : Symbol not previously defined (FSR)
00CB   0080           00406         movwf   FSR
00CC   01B8           00407         clrf    crc0
00CD   01B9           00408         clrf    crc1
00CE   2???           00409         call    crcloopr        ; Call CRC function
                      00410 
                      00411 
00CF   3054           00412         movlw   rcframe
00D0   072E           00413         addwf   rc_counter,W
Error[113]  : Symbol not previously defined (FSR)
00D1   0080           00414         movwf   FSR
                      00415         
Error[113]  : Symbol not previously defined (INDF)
00D2   0800           00416         movf    INDF,W
00D3   0239           00417         subwf   crc1,W
Error[113]  : Symbol not previously defined (STATUS)
Error[113]  : Symbol not previously defined (Z)
00D4   1C00           00418         btfss   STATUS,Z
00D5   2???           00419         goto    reccrcfail
                      00420 
MPASM  5.42  /HOME/OSCAR/SPEEDBUS/PIC/MPLABX.   7-23-2012  18:09:24         PAGE 10


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

Error[113]  : Symbol not previously defined (FSR)
00D6   0300           00421         decf    FSR,W
Error[113]  : Symbol not previously defined (FSR)
00D7   0080           00422         movwf   FSR
                      00423         
Error[113]  : Symbol not previously defined (INDF)
00D8   0800           00424         movf    INDF,W
00D9   0238           00425         subwf   crc0,W
Error[113]  : Symbol not previously defined (STATUS)
Error[113]  : Symbol not previously defined (Z)
00DA   1C00           00426         btfss   STATUS,Z
00DB   2???           00427         goto    reccrcfail
                      00428 
                      00429         
                      00430         ;; fix so that the cheksum is check:ed and do things ;)
                      00431 
                      00432         ;; REMEMBER, if checksum is right, clear rc_gotflag, else, untuched
00DC   102F           00433         bcf     rc_gotflag,0
                      00434 
00DD   305A           00435         movlw   rcframe+6       ; Move recived byte to W
Error[113]  : Symbol not previously defined (FSR)
00DE   0080           00436         movwf   FSR
                      00437 
00DF                  00438 recend_tmp:
                      00439 
00DF   18B7           00440         btfsc   speedlib_main,1 ; No CUSTOM command when in Whait for RESP STATE
00E0   2???           00441         goto    recend_no_broadcast
                      00442 
00E1   3001           00443         movlw   0x01
Error[113]  : Symbol not previously defined (INDF)
00E2   0200           00444         subwf   INDF,W
Error[113]  : Symbol not previously defined (STATUS)
Error[113]  : Symbol not previously defined (Z)
00E3   1800           00445         btfsc   STATUS,Z
00E4   2???           00446         goto    func_bc
                      00447 
00E5                  00448 recend_no_broadcast:
                      00449 
00E5   3054           00450         movlw   rcframe
Error[113]  : Symbol not previously defined (FSR)
00E6   0080           00451         movwf   FSR
Error[113]  : Symbol not previously defined (INDF)
00E7   0800           00452         movf    INDF,W          ; Check so that the adress is destinated for me
00E8   0234           00453         subwf   adress1,W
Error[113]  : Symbol not previously defined (STATUS)
Error[113]  : Symbol not previously defined (Z)
00E9   1C00           00454         btfss   STATUS,Z
00EA   2???           00455         goto    restore
Error[113]  : Symbol not previously defined (FSR)
00EB   0A00           00456         incf    FSR,W
Error[113]  : Symbol not previously defined (FSR)
00EC   0080           00457         movwf   FSR
Error[113]  : Symbol not previously defined (INDF)
MPASM  5.42  /HOME/OSCAR/SPEEDBUS/PIC/MPLABX.   7-23-2012  18:09:24         PAGE 11


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

00ED   0800           00458         movf    INDF,W
00EE   0235           00459         subwf   adress2,W
Error[113]  : Symbol not previously defined (STATUS)
Error[113]  : Symbol not previously defined (Z)
00EF   1C00           00460         btfss   STATUS,Z
00F0   2???           00461         goto    restore
                      00462 
00F1   305A           00463         movlw   rcframe+6       ; Move recived byte to W
Error[113]  : Symbol not previously defined (FSR)
00F2   0080           00464         movwf   FSR
                      00465 
00F3   3000           00466         movlw   0x00            ; Got response
Error[113]  : Symbol not previously defined (INDF)
00F4   0200           00467         subwf   INDF,W
Error[113]  : Symbol not previously defined (STATUS)
Error[113]  : Symbol not previously defined (Z)
00F5   1800           00468         btfsc   STATUS,Z
00F6   2???           00469         goto    func_check_response
                      00470 
00F7   18B7           00471         btfsc   speedlib_main,1 ; No CUSTOM command when in Whait for RESP STATE
00F8   2???           00472         goto    restore
                      00473 
00F9   0859           00474         movf    rcframe+5,W
00FA   3C01           00475         sublw   0x01
Error[113]  : Symbol not previously defined (STATUS)
Error[113]  : Symbol not previously defined (Z)
00FB   1800           00476         btfsc   STATUS,Z
00FC   2???           00477         call    func_send_response
                      00478 ;        bsf     speedlib_main,2 ; Set this bit, so the cewd knows that WHEN
                      00479 ;        btfss  STATUS,Z        ; returning to restore, send a response package
                      00480 ;        bcf     speedlib_main,2
                      00481 
                      00482 
                      00483         ;; Make sure that the FSR pointer is pointed right
00FD   305A           00484         movlw   rcframe+6       ; Move recived byte to W
Error[113]  : Symbol not previously defined (FSR)
00FE   0080           00485         movwf   FSR
                      00486 
00FF   3001           00487         movlw   0x01            ; Send respons for, 0x01 message, destionated for me
Error[113]  : Symbol not previously defined (INDF)
0100   0200           00488         subwf   INDF,W
Error[113]  : Symbol not previously defined (STATUS)
Error[113]  : Symbol not previously defined (Z)
0101   1800           00489         btfsc   STATUS,Z
0102   2???           00490         goto    func_is_ocupied_send_response
                      00491         
0103   3002           00492         movlw   0x02
Error[113]  : Symbol not previously defined (INDF)
0104   0200           00493         subwf   INDF,W
Error[113]  : Symbol not previously defined (STATUS)
Error[113]  : Symbol not previously defined (Z)
0105   1800           00494         btfsc   STATUS,Z
0106   2???           00495         goto    func_setport
MPASM  5.42  /HOME/OSCAR/SPEEDBUS/PIC/MPLABX.   7-23-2012  18:09:24         PAGE 12


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00496 
0107   3003           00497         movlw   0x03
Error[113]  : Symbol not previously defined (INDF)
0108   0200           00498         subwf   INDF,W
Error[113]  : Symbol not previously defined (STATUS)
Error[113]  : Symbol not previously defined (Z)
0109   1800           00499         btfsc   STATUS,Z
010A   2???           00500         goto    func_speedlib_config
                      00501 
                      00502 #ifdef  REC_CUSTOM_JUMP
                      00503         goto    custom_command_handler
                      00504 #endif
010B   2???           00505         goto    restore
                      00506 
010C                  00507 func_speedlib_config:
010C   3009           00508         movlw   9
010D   022E           00509         subwf   rc_counter,W
Error[113]  : Symbol not previously defined (STATUS)
Error[113]  : Symbol not previously defined (Z)
010E   1800           00510         btfsc   STATUS,Z
010F   2???           00511         goto    func_speedlib_config_basics
                      00512 
Error[113]  : Symbol not previously defined (STATUS)
Error[113]  : Symbol not previously defined (C)
0110   1800           00513         btfsc   STATUS,C
0111   2???           00514         goto    func_speedlib_config_extended
0112   2???           00515         goto    restore
                      00516 
0113                  00517 func_speedlib_config_extended:
0113   305B           00518         movlw   rcframe+7       ; Move recived byte to W
Error[113]  : Symbol not previously defined (FSR)
0114   0080           00519         movwf   FSR
0115   3000           00520         movlw   0x00
Error[113]  : Symbol not previously defined (INDF)
0116   0200           00521         subwf   INDF,W
Error[113]  : Symbol not previously defined (STATUS)
Error[113]  : Symbol not previously defined (Z)
0117   1800           00522         btfsc   STATUS,Z
0118   2???           00523         goto    func_speedlib_config_basics
0119   3001           00524         movlw   0x01
Error[113]  : Symbol not previously defined (INDF)
011A   0200           00525         subwf   INDF,W
Error[113]  : Symbol not previously defined (STATUS)
Error[113]  : Symbol not previously defined (Z)
011B   1800           00526         btfsc   STATUS,Z
011C   2???           00527         goto    func_speedlib_config_caddr
011D   2???           00528         goto    restore
                      00529 
                      00530 
011E                  00531 func_speedlib_config_caddr:
011E   300C           00532         movlw   12
011F   022E           00533         subwf   rc_counter,W
Error[113]  : Symbol not previously defined (STATUS)
MPASM  5.42  /HOME/OSCAR/SPEEDBUS/PIC/MPLABX.   7-23-2012  18:09:24         PAGE 13


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

Error[113]  : Symbol not previously defined (C)
0120   1C00           00534         btfss   STATUS,C    ;; If rc_counter NOT is more och equal to twelve, jump back
0121   2???           00535         goto    restore
                      00536 
0122   2???           00537         call    func_send_response
                      00538 
                      00539 
0123   305C           00540         movlw   rcframe+8       ; Move recived byte to W
Error[113]  : Symbol not previously defined (FSR)
0124   0080           00541         movwf   FSR
Error[113]  : Symbol not previously defined (INDF)
0125   0800           00542         movf    INDF,W
0126   00B4           00543         movwf   adress1
Error[113]  : Symbol not previously defined (FSR)
0127   0A80           00544         incf    FSR,f
Error[113]  : Symbol not previously defined (INDF)
0128   0800           00545         movf    INDF,W
0129   00B5           00546         movwf   adress2
                      00547 
012A   14B6           00548         bsf     speedlib_config,1
                      00549         ;; Here you probobly want some cewd that writes tha adress to eeprom TODO
012B   3000           00550         movlw   0
012C   00B0           00551         movwf   rc_nocoll
012D   0834           00552         movf    adress1,W
012E   2???           00553         call    write_eeprom
012F   3001           00554         movlw   1
0130   00B0           00555         movwf   rc_nocoll
0131   0835           00556         movf    adress2,W
0132   2???           00557         call    write_eeprom
0133   3002           00558         movlw   2
0134   00B0           00559         movwf   rc_nocoll
0135   0836           00560         movf    speedlib_config,W
0136   2???           00561         call    write_eeprom
0137   2???           00562         goto    restore
                      00563 
0138                  00564 func_speedlib_config_basics:
0138   300C           00565         movlw   12
0139   2???           00566         call    Delay
013A   300B           00567         movlw   11
013B   00BC           00568         movwf   framelen
                      00569         ;; 0xff broadcast dst adress
013C   3056           00570         movlw   rcframe+2         ;       dst addr
Error[113]  : Symbol not previously defined (FSR)
013D   0080           00571         movwf   FSR
Error[113]  : Symbol not previously defined (INDF)
013E   0800           00572         movf    INDF,W
013F   00BF           00573         movwf   txframe
                      00574         ;; 0xff broadcast dst adress
0140   3057           00575         movlw   rcframe+3         ;       dst addr
Error[113]  : Symbol not previously defined (FSR)
0141   0080           00576         movwf   FSR
Error[113]  : Symbol not previously defined (INDF)
0142   0800           00577         movf    INDF,W
MPASM  5.42  /HOME/OSCAR/SPEEDBUS/PIC/MPLABX.   7-23-2012  18:09:24         PAGE 14


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0143   00C0           00578         movwf   txframe+1
                      00579         ;; * my own src adress
0144   0834           00580         movf    adress1, W
0145   00C1           00581         movwf   txframe+2
                      00582         ;; * my own src adress
0146   0835           00583         movf    adress2, W
0147   00C2           00584         movwf   txframe+3
                      00585         ;; 0x03 control bit
0148   3003           00586         movlw   0x03
0149   00C3           00587         movwf   txframe+4
                      00588         ;; 0x01 protocoll
014A   3000           00589         movlw   0x00
014B   00C4           00590         movwf   txframe+5
                      00591         ;; Data
014C   3003           00592         movlw   0x03
014D   00C5           00593         movwf   txframe+6
                      00594         ;; 0x00 Basic config response
014E   3000           00595         movlw   0x00
014F   00C6           00596         movwf   txframe+7
                      00597         ;; Send back speedlib_config
0150   3036           00598         movlw   speedlib_config
0151   00C7           00599         movwf   txframe+8
                      00600         ;; Padding bit
0152   3000           00601         movlw   0x00
0153   00C8           00602         movwf   txframe+9
                      00603 
0154   2???           00604         call    txdo
0155   2???           00605         goto    restore
                      00606 
0156                  00607 func_send_response:
0156   300C           00608         movlw   12
0157   2???           00609         call    Delay
0158   3009           00610         movlw   9
0159   00BC           00611         movwf   framelen
                      00612         ;; 0xff broadcast dst adress
015A   3056           00613         movlw   rcframe+2         ;       dst addr
Error[113]  : Symbol not previously defined (FSR)
015B   0080           00614         movwf   FSR
Error[113]  : Symbol not previously defined (INDF)
015C   0800           00615         movf    INDF,W
015D   00BF           00616         movwf   txframe
                      00617         ;; 0xff broadcast dst adress
015E   3057           00618         movlw   rcframe+3         ;       dst addr
Error[113]  : Symbol not previously defined (FSR)
015F   0080           00619         movwf   FSR
Error[113]  : Symbol not previously defined (INDF)
0160   0800           00620         movf    INDF,W
0161   00C0           00621         movwf   txframe+1
                      00622         ;; * my own src adress
0162   0834           00623         movf    adress1, W
0163   00C1           00624         movwf   txframe+2
                      00625         ;; * my own src adress
0164   0835           00626         movf    adress2, W
MPASM  5.42  /HOME/OSCAR/SPEEDBUS/PIC/MPLABX.   7-23-2012  18:09:24         PAGE 15


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0165   00C2           00627         movwf   txframe+3
                      00628         ;; 0x03 control bit
0166   3003           00629         movlw   0x03
0167   00C3           00630         movwf   txframe+4
                      00631         ;; 0x01 protocoll
0168   3001           00632         movlw   0x01
0169   00C4           00633         movwf   txframe+5
                      00634         ;; Data
016A   3000           00635         movlw   0x00
016B   00C5           00636         movwf   txframe+6
                      00637         ;; Padding bit
016C   3000           00638         movlw   0x00
016D   00C6           00639         movwf   txframe+7
                      00640 
                      00641         ;; This is a broadcast package with adress on it
                      00642 
016E   2???           00643         call    txdo
016F   0008           00644         return
                      00645 
0170                  00646 func_check_response:
                      00647 ; May be more advanced in the future, but for now, i dont se any reason why
                      00648 ; we should make this functione more advanced, how many response packages are
                      00649 ; realy exchange in a cuple of ms? -.- //  Speedster
0170   15AD           00650         bsf     rc_listen,3
0171   2???           00651         goto    restore
                      00652 
                      00653 
0172                  00654 func_is_ocupied_send_response:
0172   300C           00655         movlw   12              ; Pretty strange, but you need this, so no colission or somthing will be
                             made betwen PC and ansoring device
0173   2???           00656         call    Delay
                      00657         ;; Send Package:
0174   182D           00658         btfsc   rc_listen,0
0175   2???           00659         goto    func_is_ocupied_send_response_got_resp
0176   2???           00660         goto    func_is_ocupied_send_response_pack
Warning[208]: Label truncated at 32 characters. (func_is_ocupied_send_response_got_resp)
0177                  00661 func_is_ocupied_send_response_got_resp:
0177   102D           00662         bcf     rc_listen,0
0178   2???           00663         goto    restore
                      00664 
Warning[208]: Label truncated at 32 characters. (func_is_ocupied_send_response_pack)
0179                  00665 func_is_ocupied_send_response_pack:
0179   3009           00666         movlw   9
017A   00BC           00667         movwf   framelen
                      00668         ;; 0xff broadcast dst adress
017B   3056           00669         movlw   rcframe+2         ;       dst addr
Error[113]  : Symbol not previously defined (FSR)
017C   0080           00670         movwf   FSR
Error[113]  : Symbol not previously defined (INDF)
017D   0800           00671         movf    INDF,W
017E   00BF           00672         movwf   txframe
                      00673         ;; 0xff broadcast dst adress
017F   3057           00674         movlw   rcframe+3         ;       dst addr
MPASM  5.42  /HOME/OSCAR/SPEEDBUS/PIC/MPLABX.   7-23-2012  18:09:24         PAGE 16


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

Error[113]  : Symbol not previously defined (FSR)
0180   0080           00675         movwf   FSR
Error[113]  : Symbol not previously defined (INDF)
0181   0800           00676         movf    INDF,W
0182   00C0           00677         movwf   txframe+1
                      00678         ;; * my own src adress
0183   0834           00679         movf    adress1, W
0184   00C1           00680         movwf   txframe+2
                      00681         ;; * my own src adress
0185   0835           00682         movf    adress2, W
0186   00C2           00683         movwf   txframe+3
                      00684         ;; 0x03 control bit
0187   3003           00685         movlw   0x03
0188   00C3           00686         movwf   txframe+4
                      00687         ;; 0x01 protocoll
0189   3000           00688         movlw   0x00
018A   00C4           00689         movwf   txframe+5
                      00690         ;; Data
018B   3001           00691         movlw   0x01
018C   00C5           00692         movwf   txframe+6
                      00693         ;; Padding bit
018D   3000           00694         movlw   0x00
018E   00C6           00695         movwf   txframe+7
                      00696         
                      00697         ;; This is a broadcast package with adress on it
                      00698 
018F   2???           00699         call    txdo    
                      00700 
0190   2???           00701         goto    restore
                      00702 
                      00703         
0191                  00704 func_bc:
                      00705 ; 120623 A new era has become speedbus, all package that are need to, shall for
                      00706 ; now be sent with an respons, and, for that reason, i no more use command 0x00
                      00707 ; for is_occupied commands. When an 0x01 NOT is broadcast(it got a real adress)
                      00708 ; It is ment to bee like an old 0x00, if it is not an bc, send is_occupied.
                      00709 ; For now on, 0x00 is used to respond packages that need a response! Over'n out
                      00710 ; // Speedster
                      00711 
0191   3054           00712         movlw   rcframe         ;       dst addr
Error[113]  : Symbol not previously defined (FSR)
0192   0080           00713         movwf   FSR
                      00714         
0193   30FF           00715         movlw   0xFF            ;       check dst adress1
Error[113]  : Symbol not previously defined (INDF)
0194   0200           00716         subwf   INDF,W
Error[113]  : Symbol not previously defined (STATUS)
Error[113]  : Symbol not previously defined (Z)
0195   1C00           00717         btfss   STATUS,Z
0196   2???           00718         goto    recend_no_broadcast
                      00719         
Error[113]  : Symbol not previously defined (FSR)
0197   0A00           00720         incf    FSR,W           ;       Increase the address    
MPASM  5.42  /HOME/OSCAR/SPEEDBUS/PIC/MPLABX.   7-23-2012  18:09:24         PAGE 17


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

Error[113]  : Symbol not previously defined (FSR)
0198   0080           00721         movwf   FSR
                      00722 
0199   30FF           00723         movlw   0xFF            ;       check dst adress2
Error[113]  : Symbol not previously defined (INDF)
019A   0200           00724         subwf   INDF,W
Error[113]  : Symbol not previously defined (STATUS)
Error[113]  : Symbol not previously defined (Z)
019B   1C00           00725         btfss   STATUS,Z
019C   2???           00726         goto    recend_no_broadcast
                      00727 
019D   305A           00728         movlw   rcframe+6         ;       dst addr
Error[113]  : Symbol not previously defined (FSR)
019E   0080           00729         movwf   FSR
019F   3001           00730         movlw   0x01            ;       check dst adress2
Error[113]  : Symbol not previously defined (INDF)
01A0   0200           00731         subwf   INDF,W
Error[113]  : Symbol not previously defined (STATUS)
Error[113]  : Symbol not previously defined (Z)
01A1   1800           00732         btfsc   STATUS,Z
01A2   2???           00733         goto    func_bc_sendaddr
01A3   2???           00734         goto    restore
                      00735         
01A4                  00736 func_bc_sendaddr:       
01A4   2???           00737         call    trd      ; Three random delay:s before ansor broadcast
                      00738 
01A5   2???           00739         call    func_set_rsp_addr ;; Set rsp_adress to the src adress of the last recived package
                      00740 
                      00741         ;; Send Package:
                      00742         
01A6   300B           00743         movlw   11
01A7   00BC           00744         movwf   framelen
                      00745         ;; dst adress
01A8   0832           00746         movf    rsp_adress1,W
01A9   00BF           00747         movwf   txframe
                      00748         ;; dst adress
01AA   0833           00749         movf    rsp_adress2,W
01AB   00C0           00750         movwf   txframe+1
                      00751         ;; * my own src adress
01AC   0834           00752         movf    adress1, W
01AD   00C1           00753         movwf   txframe+2
                      00754         ;; * my own src adress
01AE   0835           00755         movf    adress2, W
01AF   00C2           00756         movwf   txframe+3
                      00757         ;; 0x03 control bit
01B0   3003           00758         movlw   0x03
01B1   00C3           00759         movwf   txframe+4
                      00760         ;; 0x01 protocoll
01B2   3001           00761         movlw   0x01
01B3   00C4           00762         movwf   txframe+5
                      00763         ;; Data
01B4   3001           00764         movlw   0x01
01B5   00C5           00765         movwf   txframe+6
MPASM  5.42  /HOME/OSCAR/SPEEDBUS/PIC/MPLABX.   7-23-2012  18:09:24         PAGE 18


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00766         ;; Data - DeviceID
01B6   3000           00767         movlw   DEV_ID1
01B7   00C6           00768         movwf   txframe+7
                      00769         ;; Data - DeviceID
01B8   3000           00770         movlw   DEV_ID2
01B9   00C7           00771         movwf   txframe+8
                      00772         ;; Padding bit
01BA   3000           00773         movlw   0x00
01BB   00C8           00774         movwf   txframe+9
                      00775         
                      00776         ;; This is a broadcast package with adress on it
                      00777 ;
01BC   3001           00778         movlw   0x01
01BD   0259           00779         subwf   rcframe+5,W
Error[113]  : Symbol not previously defined (STATUS)
Error[113]  : Symbol not previously defined (Z)
01BE   1800           00780         btfsc   STATUS,Z
01BF   2???           00781         goto    handle_response
01C0   2???           00782         call    txdo
                      00783 ;
                      00784 
01C1                  00785 func_bc_sended_packet:
01C1   2???           00786         goto    restore
                      00787 
01C2                  00788 func_setport:
01C2   3002           00789         movlw   2
Error[113]  : Symbol not previously defined (FSR)
01C3   0780           00790         addwf   FSR,F
Error[113]  : Symbol not previously defined (INDF)
01C4   0800           00791         movf    INDF,W
Error[113]  : Symbol not previously defined (PORTC)
01C5   0080           00792         movwf   PORTC
01C6   2???           00793         goto    restore
                      00794 
01C7                  00795 func_set_rsp_addr:
                      00796         ;; Add last rec package src addr to rsp_adress1 rsp_adress2
01C7   3056           00797         movlw   rcframe+2         ;       dst addr
Error[113]  : Symbol not previously defined (FSR)
01C8   0080           00798         movwf   FSR
Error[113]  : Symbol not previously defined (INDF)
01C9   0800           00799         movf    INDF,W
01CA   00B2           00800         movwf   rsp_adress1
01CB   3057           00801         movlw   rcframe+3         ;       dst addr
Error[113]  : Symbol not previously defined (FSR)
01CC   0080           00802         movwf   FSR
Error[113]  : Symbol not previously defined (INDF)
01CD   0800           00803         movf    INDF,W
01CE   00B3           00804         movwf   rsp_adress2
01CF   0008           00805         return
                      00806 
01D0                  00807 handle_response:
01D0   11AD           00808         bcf     rc_listen,3
01D1   14B7           00809         bsf     speedlib_main,1
MPASM  5.42  /HOME/OSCAR/SPEEDBUS/PIC/MPLABX.   7-23-2012  18:09:24         PAGE 19


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

01D2   10AD           00810         bcf     rc_listen,1
                      00811 
                      00812 
                      00813     ; Important, this should be run in "main space", not interupt space, soo,
                      00814     ; well, now it is runed somewheare in the middle, wait for response STATE
01D3   300A           00815         movlw   10
01D4   00AB           00816         movwf   loop1
01D5                  00817 handle_response_loop:
Error[113]  : Symbol not previously defined (INTCON)
Error[113]  : Symbol not previously defined (GIE)
01D5   1000           00818         bcf     INTCON,GIE
01D6   2???           00819         call    txdo
Error[113]  : Symbol not previously defined (RCREG)
01D7   0800           00820         movf    RCREG,W     ;; Just to clear RCIF
Error[113]  : Symbol not previously defined (RCREG)
01D8   0800           00821         movf    RCREG,W     ;; Just to clear RCIF
Error[113]  : Symbol not previously defined (RCREG)
01D9   0800           00822         movf    RCREG,W     ;; Just to clear RCIF
Error[113]  : Symbol not previously defined (INTCON)
Error[113]  : Symbol not previously defined (GIE)
01DA   1400           00823         bsf     INTCON,GIE
01DB   30FA           00824         movlw   250
01DC   2???           00825         call    Delay
                      00826 
                      00827         ;; If error
Error[113]  : Symbol not previously defined (RCSTA)
Error[113]  : Symbol not previously defined (OERR)
01DD   1800           00828         btfsc   RCSTA,OERR
01DE   2???           00829         call    recerror
                      00830         ;;
01DF   19AD           00831         btfsc   rc_listen,3
01E0   2???           00832         goto    handle_response_ret
01E1   0BAB           00833         decfsz  loop1,f
01E2   2???           00834         goto    handle_response_loop
                      00835 
01E3                  00836 handle_response_ret:
01E3   11AD           00837         bcf     rc_listen,3
01E4   10B7           00838         bcf     speedlib_main,1
01E5   2???           00839         goto    restore
                      00840 
01E6                  00841 reccrcfail:
                      00842         ;; Because that this happend directrly after a crc-fail, here we need to clear the counter, so t
                            he newxt comming package will start allover
01E6   01AE           00843         clrf    rc_counter
                      00844         ;; Do somthing
01E7   3001           00845         movlw    B'00000001'    ;toggle bit3
Error[113]  : Symbol not previously defined (PORTC)
01E8   0680           00846         xorwf    PORTC,F
01E9   2???           00847         goto    restore
                      00848         
01EA                  00849 recerror:
                      00850         ;; Do somthing
Error[113]  : Symbol not previously defined (RCSTA)
MPASM  5.42  /HOME/OSCAR/SPEEDBUS/PIC/MPLABX.   7-23-2012  18:09:24         PAGE 20


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

Error[113]  : Symbol not previously defined (CREN)
01EA   1000           00851         bcf     RCSTA,CREN
Error[113]  : Symbol not previously defined (RCSTA)
Error[113]  : Symbol not previously defined (CREN)
01EB   1400           00852         bsf     RCSTA,CREN
01EC   0008           00853         return
01ED                  00854 txoops:                         ; Colisson has ocurred
01ED   10BE           00855         bcf     txreturn,1
01EE   2???           00856         call    lfsr
01EF   082A           00857         movf    rand,W
01F0   2???           00858         call    Delay
01F1   2???           00859         goto    txdo2
                      00860 
01F2                  00861 tx_send:
01F2   00BD           00862         movwf   txtmp
01F3   307E           00863         movlw   0x7e            
01F4   023D           00864         subwf   txtmp,W         
Error[113]  : Symbol not previously defined (STATUS)
Error[113]  : Symbol not previously defined (Z)
01F5   1800           00865         btfsc   STATUS,Z
01F6   2???           00866         goto    tx_send_escape_1
                      00867 
01F7   307D           00868         movlw   0x7d
01F8   023D           00869         subwf   txtmp,W
Error[113]  : Symbol not previously defined (STATUS)
Error[113]  : Symbol not previously defined (Z)
01F9   1800           00870         btfsc   STATUS,Z
01FA   2???           00871         goto    tx_send_escape_2
01FB   083D           00872         movf    txtmp,W
                      00873         
01FC                  00874 tx_send_noescape:       
01FC   00BD           00875         movwf   txtmp
Error[113]  : Symbol not previously defined (STATUS)
Error[113]  : Symbol not previously defined (RP0)
01FD   1400           00876         bsf     STATUS,RP0      ;bank 1                          |B1
Error[113]  : Symbol not previously defined (TXSTA)
Error[113]  : Symbol not previously defined (TRMT)
01FE   1C00           00877         btfss   TXSTA,TRMT
01FF   2???           00878         goto    $-1
Error[113]  : Symbol not previously defined (STATUS)
Error[113]  : Symbol not previously defined (RP0)
0200   1000           00879         bcf     STATUS,RP0 ; bank 1                          |B1 
                      00880 
0201   3002           00881         movlw   0x02
0202   00A0           00882         movwf   d1
0203   30FF           00883         movlw   0xFF
Error[113]  : Symbol not previously defined (W)
0204   0B80           00884         decfsz  W,f
0205   2???           00885         goto    $-1
0206   0BA0           00886         decfsz  d1,f
0207   2???           00887         goto    $-4
                      00888 
0208   083D           00889         movf    txtmp,W
MPASM  5.42  /HOME/OSCAR/SPEEDBUS/PIC/MPLABX.   7-23-2012  18:09:24         PAGE 21


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0209   14AD           00890         bsf     rc_listen, 1
020A   00B0           00891         movwf   rc_nocoll
Error[113]  : Symbol not previously defined (TXREG)
020B   0080           00892         movwf   TXREG
                      00893 
020C   3002           00894         movlw   0x02
020D   00A0           00895         movwf   d1
020E   30FF           00896         movlw   0xFF
Error[113]  : Symbol not previously defined (W)
020F   0B80           00897         decfsz  W,f
0210   2???           00898         goto    $-1
0211   0BA0           00899         decfsz  d1,f
0212   2???           00900         goto    $-4
                      00901 
0213   18BE           00902         btfsc   txreturn,1
0214   2???           00903         goto    txoops
0215   0008           00904         return
                      00905 
0216                  00906 tx_send_escape_1:
0216   307D           00907         movlw   0x7d
0217   2???           00908         call    tx_send_noescape
0218   305E           00909         movlw   0x5e
0219   2???           00910         call    tx_send_noescape
021A   0008           00911         return
                      00912 
021B                  00913 tx_send_escape_2:
021B   307D           00914         movlw   0x7d
021C   2???           00915         call    tx_send_noescape
021D   305D           00916         movlw   0x5d
021E   2???           00917         call    tx_send_noescape
021F   0008           00918         return
                      00919         
                      00920 
0220                  00921 txdo:                           ; This is like the funktion argumnents, they need to be set at every pre
                            sense of crcloopr
                      00922         ;; Set TX enable
Error[113]  : Symbol not previously defined (PORTB)
0220   1600           00923         bsf     PORTB,4
                      00924         ;;
0221   083C           00925         movf    framelen,W
0222   00BA           00926         movwf   crcloop
0223   303F           00927         movlw   txframe
Error[113]  : Symbol not previously defined (FSR)
0224   0080           00928         movwf   FSR
0225   01B8           00929         clrf    crc0
0226   01B9           00930         clrf    crc1
0227   2???           00931         call    crcloopr
0228   2???           00932         goto    txdo2
0229                  00933 crcloopr:
0229   0BBA           00934         decfsz  crcloop, f
022A   2???           00935         goto    crccalc
022B   0008           00936         return
                      00937 
MPASM  5.42  /HOME/OSCAR/SPEEDBUS/PIC/MPLABX.   7-23-2012  18:09:24         PAGE 22


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

022C                  00938 crccalc:        
Error[113]  : Symbol not previously defined (INDF)
022C   0800           00939         movf  INDF,W            ;;load w with next databyte
022D   0639           00940         xorwf crc1,W            ;;(a^x):(b^y)
022E   00BB           00941         movwf crctmp            ;;
022F   39F0           00942         andlw 0xf0              ;; W = (a^x):0
0230   0EBB           00943         swapf crctmp,F          ;; Index = (b^y):(a^x)
0231   06BB           00944         xorwf crctmp,F          ;; Index = (a^b^x^y):(a^x) = i2:i1
                      00945 
                      00946                                 ;; High byte
0232   083B           00947         movf  crctmp,W
0233   39F0           00948         andlw 0xf0
0234   0638           00949         xorwf crc0,W
0235   00B9           00950         movwf crc1
                      00951 
0236   0D3B           00952         rlf  crctmp,W           ;; use rlf for PIC16
0237   0D3B           00953         rlf  crctmp,W           ;; use rlf for PIC16
0238   06B9           00954         xorwf crc1,F
0239   39E0           00955         andlw 0xe0
023A   06B9           00956         xorwf crc1,F
                      00957 
023B   0EBB           00958         swapf crctmp,F
023C   063B           00959         xorwf crctmp,W
023D   00B8           00960         movwf crc0
Error[113]  : Symbol not previously defined (FSR)
023E   0A00           00961         incf    FSR,W
Error[113]  : Symbol not previously defined (FSR)
023F   0080           00962         movwf   FSR
0240   2???           00963         goto crcloopr
                      00964 
0241                  00965 txdo2:
0241   307E           00966         movlw   0x7e
0242   2???           00967         call    tx_send_noescape
0243   303F           00968         movlw   txframe
Error[113]  : Symbol not previously defined (FSR)
0244   0080           00969         movwf   FSR
0245   083C           00970         movf    framelen,W
0246   00BA           00971         movwf   crcloop
0247                  00972 send:
0247   0BBA           00973         decfsz  crcloop,f
0248   2???           00974         goto    lopp
0249   2???           00975         goto    crcsend
024A                  00976 lopp:
Error[113]  : Symbol not previously defined (INDF)
024A   0800           00977         movf    INDF,W
024B   2???           00978         call    tx_send
Error[113]  : Symbol not previously defined (FSR)
024C   0A00           00979         incf    FSR,W
Error[113]  : Symbol not previously defined (FSR)
024D   0080           00980         movwf   FSR
024E   2???           00981         goto    send
                      00982 
024F                  00983 crcsend:
MPASM  5.42  /HOME/OSCAR/SPEEDBUS/PIC/MPLABX.   7-23-2012  18:09:24         PAGE 23


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

024F   0838           00984         movf    crc0,W
0250   2???           00985         call    tx_send
0251   0839           00986         movf    crc1,W
0252   2???           00987         call    tx_send
0253   2???           00988         goto    endflag
                      00989 
0254                  00990 endflag:
0254   307E           00991         movlw   0x7e
0255   2???           00992         call    tx_send_noescape
                      00993         ;; Disable TX enable
Error[113]  : Symbol not previously defined (PORTB)
0256   1200           00994         bcf     PORTB,4
                      00995 
0257   0008           00996         return
                      00997 
0258                  00998 trd:    
0258   2???           00999         call    lfsr            ; Three random delays before sending broadcast
0259   082A           01000         movf    rand,W
025A   2???           01001         call    Delay
025B   2???           01002         call    lfsr
025C   082A           01003         movf    rand,W
025D   2???           01004         call    Delay
025E   2???           01005         call    lfsr
025F   082A           01006         movf    rand,W
0260   2???           01007         call    Delay
0261   0008           01008         return
                      01009         
0262                  01010 lfsr:
0262   0D2A           01011         rlf     rand,W
0263   0D2A           01012         rlf     rand,W
0264   1A2A           01013         btfsc   rand,4
0265   3A01           01014         xorlw   1
0266   1AAA           01015         btfsc   rand,5
0267   3A01           01016         xorlw   1
0268   19AA           01017         btfsc   rand,3
0269   3A01           01018         xorlw   1
026A   00AA           01019         movwf   rand
026B   3400           01020         retlw   0
                      01021         
026C                  01022 Delay:
                      01023         ;; 499994 cycles
026C   00A2           01024         movwf   d3
026D   30FF           01025         movlw   0xFF
026E   00A1           01026         movwf   d2
026F   3032           01027         movlw   50
0270   00A0           01028         movwf   d1
0271                  01029 Delay_0:
0271   0BA0           01030         decfsz  d1, f
0272   2???           01031         goto    $-1
0273   3014           01032         movlw   20              ; Need this for tuning
0274   00A0           01033         movwf   d1
0275   0BA1           01034         decfsz  d2, f
0276   2???           01035         goto    $-6
MPASM  5.42  /HOME/OSCAR/SPEEDBUS/PIC/MPLABX.   7-23-2012  18:09:24         PAGE 24


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0277   3064           01036         movlw   100
0278   00A1           01037         movwf   d2
0279   0BA2           01038         decfsz  d3, f
027A   2???           01039         goto    Delay_0
027B   0008           01040         return
                      01041 
027C                  01042 read_eeprom:
Error[113]  : Symbol not previously defined (STATUS)
Error[113]  : Symbol not previously defined (RP1)
027C   1400           01043         bsf     STATUS, RP1
                      01044         ;; Take the preset W number, and take the byte from the addr
Error[113]  : Symbol not previously defined (EEADR)
027D   0080           01045         movwf   EEADR
Error[113]  : Symbol not previously defined (STATUS)
Error[113]  : Symbol not previously defined (RP0)
027E   1400           01046         bsf     STATUS, RP0
Error[113]  : Symbol not previously defined (EECON1)
Error[113]  : Symbol not previously defined (EEPGD)
027F   1000           01047         bcf     EECON1, EEPGD
Error[113]  : Symbol not previously defined (EECON1)
Error[113]  : Symbol not previously defined (RD)
0280   1400           01048         bsf     EECON1, RD
Error[113]  : Symbol not previously defined (STATUS)
Error[113]  : Symbol not previously defined (RP0)
0281   1000           01049         bcf     STATUS, RP0
                      01050         ;; Put the result in W
Error[113]  : Symbol not previously defined (EEDAT)
0282   0800           01051         movf    EEDAT, W
Error[113]  : Symbol not previously defined (STATUS)
Error[113]  : Symbol not previously defined (RP1)
0283   1000           01052         bcf     STATUS, RP1
0284   0008           01053         return
                      01054 
0285                  01055 write_eeprom:
Error[113]  : Symbol not previously defined (STATUS)
Error[113]  : Symbol not previously defined (RP1)
0285   1400           01056         bsf     STATUS, RP1
Error[113]  : Symbol not previously defined (EEDAT)
0286   0080           01057         movwf   EEDAT ; write the value already in W to EEDAT, the data
Error[113]  : Symbol not previously defined (STATUS)
Error[113]  : Symbol not previously defined (RP1)
0287   1000           01058         bcf     STATUS, RP1 ; Need this to get rc_nocoll
0288   0830           01059         movf    rc_nocoll,W
Error[113]  : Symbol not previously defined (STATUS)
Error[113]  : Symbol not previously defined (RP1)
0289   1400           01060         bsf     STATUS, RP1 ;; ^^^^^^^^^^^
Error[113]  : Symbol not previously defined (EEADR)
028A   0080           01061         movwf   EEADR
Error[113]  : Symbol not previously defined (STATUS)
Error[113]  : Symbol not previously defined (RP0)
028B   1400           01062         bsf     STATUS, RP0
Error[113]  : Symbol not previously defined (EECON1)
Error[113]  : Symbol not previously defined (EEPGD)
MPASM  5.42  /HOME/OSCAR/SPEEDBUS/PIC/MPLABX.   7-23-2012  18:09:24         PAGE 25


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

028C   1000           01063         bcf     EECON1, EEPGD
Error[113]  : Symbol not previously defined (EECON1)
Error[113]  : Symbol not previously defined (WREN)
028D   1400           01064         bsf     EECON1, WREN
                      01065 
                      01066         ; bcf   INTCON, GIE ; Well, GIE should be zero when it gets here
028E   3055           01067         movlw   0x55
Error[113]  : Symbol not previously defined (EECON2)
028F   0080           01068         movwf   EECON2
0290   30AA           01069         movlw   0xAA
Error[113]  : Symbol not previously defined (EECON2)
0291   0080           01070         movwf   EECON2
Error[113]  : Symbol not previously defined (EECON1)
Error[113]  : Symbol not previously defined (WR)
0292   1400           01071         bsf     EECON1, WR
                      01072         ; bsf     INTCON, GIE
                      01073 
Error[113]  : Symbol not previously defined (EECON1)
Error[113]  : Symbol not previously defined (WR)
0293   1800           01074         btfsc   EECON1, WR
0294   2???           01075         goto    $-1
                      01076 
                      01077 
Error[113]  : Symbol not previously defined (EECON1)
Error[113]  : Symbol not previously defined (WREN)
0295   1000           01078         bcf     EECON1, WREN
Error[113]  : Symbol not previously defined (STATUS)
Error[113]  : Symbol not previously defined (RP0)
0296   1000           01079         bcf     STATUS, RP0
Error[113]  : Symbol not previously defined (STATUS)
Error[113]  : Symbol not previously defined (RP1)
0297   1000           01080         bcf     STATUS, RP1
0298   0008           01081         return
Error[129]  : Expected (END)
MPASM  5.42  /HOME/OSCAR/SPEEDBUS/PIC/MPLABX.   7-23-2012  18:09:24         PAGE 26


SYMBOL TABLE
  LABEL                             VALUE 

DEV_ID1                           0
DEV_ID2                           0
Delay                             0000026C
Delay_0                           00000271
USER_VARIABLE_SPACE               0x49
_.code_page0__01FF                000001FF
_.code_page0__0205                00000205
_.code_page0__0207                00000207
_.code_page0__0210                00000210
_.code_page0__0212                00000212
_.code_page0__0272                00000272
_.code_page0__0276                00000276
_.code_page0__0294                00000294
__16F690                          00000001
adress1                           00000034
adress2                           00000035
crc0                              00000038
crc1                              00000039
crccalc                           0000022C
crcloop                           0000003A
crcloopr                          00000229
crcsend                           0000024F
crctmp                            0000003B
d1                                00000020
d1_tmp                            00000027
d2                                00000021
d2_tmp                            00000028
d3                                00000022
d3_tmp                            00000029
d4                                00000023
endflag                           00000254
framelen                          0000003C
func_bc                           00000191
func_bc_sendaddr                  000001A4
func_bc_sended_packet             000001C1
func_check_response               00000170
func_is_ocupied_send_response     00000172
func_is_ocupied_send_response_go  00000177
func_is_ocupied_send_response_pa  00000179
func_send_response                00000156
func_set_rsp_addr                 000001C7
func_setport                      000001C2
func_speedlib_config              0000010C
func_speedlib_config_basics       00000138
func_speedlib_config_caddr        0000011E
func_speedlib_config_extended     00000113
handle_response                   000001D0
handle_response_loop              000001D5
handle_response_ret               000001E3
init_checkaddr                    0000001B
init_checkaddr_l                  0000001D
init_checkaddr_not_ocupied        00000036
init_checkaddr_ocupied            0000003A
MPASM  5.42  /HOME/OSCAR/SPEEDBUS/PIC/MPLABX.   7-23-2012  18:09:24         PAGE 27


SYMBOL TABLE
  LABEL                             VALUE 

init_speedlib                     00000000
init_speedlib_e                   0000001A
intserv                           0000006B
intserv_norm                      00000071
lfsr                              00000262
loop1                             0000002B
loop2                             0000002C
lopp                              0000024A
rand                              0000002A
rc1                               00000055
rc10                              0000005E
rc11                              0000005F
rc12                              00000060
rc13                              00000061
rc14                              00000062
rc15                              00000063
rc16                              00000064
rc17                              00000065
rc18                              00000066
rc19                              00000067
rc2                               00000056
rc20                              00000068
rc3                               00000057
rc4                               00000058
rc5                               00000059
rc6                               0000005A
rc7                               0000005B
rc8                               0000005C
rc9                               0000005D
rc_add_byte                       00000031
rc_counter                        0000002E
rc_gotflag                        0000002F
rc_listen                         0000002D
rc_nocoll                         00000030
rcframe                           00000054
read_eeprom                       0000027C
rec                               0000008E
rec_oops_coll                     00000096
rec_start                         00000099
reccrcfail                        000001E6
recend                            000000C7
recend_no_broadcast               000000E5
recend_tmp                        000000DF
recerror                          000001EA
recr                              000000A5
recsave                           000000A6
recsave_add                       000000BE
recsave_set                       000000AE
recsave_unescape                  000000B0
recsave_unescape_1                000000BA
recsave_unescape_2                000000BC
recx                              000000A0
restore                           0000007F
MPASM  5.42  /HOME/OSCAR/SPEEDBUS/PIC/MPLABX.   7-23-2012  18:09:24         PAGE 28


SYMBOL TABLE
  LABEL                             VALUE 

restore_norm                      00000081
rsp_adress1                       00000032
rsp_adress2                       00000033
send                              00000247
setaddr                           0000003C
setaddr1                          00000040
setaddr2                          00000047
setaddr_testloop                  00000060
setaddr_testloop_l                00000062
speedlib_config                   00000036
speedlib_main                     00000037
tmp_PCLATH                        00000026
tmp_STATUS                        00000025
tmp_W                             00000024
trd                               00000258
tx1                               00000040
tx10                              00000049
tx11                              0000004A
tx12                              0000004B
tx13                              0000004C
tx14                              0000004D
tx15                              0000004E
tx16                              0000004F
tx17                              00000050
tx18                              00000051
tx19                              00000052
tx2                               00000041
tx20                              00000053
tx3                               00000042
tx4                               00000043
tx5                               00000044
tx6                               00000045
tx7                               00000046
tx8                               00000047
tx9                               00000048
tx_send                           000001F2
tx_send_escape_1                  00000216
tx_send_escape_2                  0000021B
tx_send_noescape                  000001FC
txdo                              00000220
txdo2                             00000241
txframe                           0000003F
txoops                            000001ED
txreturn                          0000003E
txtmp                             0000003D
write_eeprom                      00000285

Errors   :   201
Warnings :     2 reported,     0 suppressed
Messages :     0 reported,     0 suppressed

